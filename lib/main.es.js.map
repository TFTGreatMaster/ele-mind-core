{"version":3,"file":"main.es.js","sources":["../src/types/index.ts","../src/models/block.ts","../src/configs/theme/types.ts","../src/configs/theme/default-theme.ts","../src/models/config.ts","../src/models/topic.ts","../src/models/desc-block-data.ts","../src/models/utils/index.ts","../src/utils/index.ts","../src/models/sheet-model-modifier.ts","../src/models/doc-model-modifier.ts","../src/models/sheet-model.ts","../src/models/doc-model.ts","../src/plugins/core.ts","../src/controller.ts"],"sourcesContent":["import { DocModel } from '../models';\r\n\r\nexport type KeyType = string;\r\n\r\nexport type KeyPath = KeyType[];\r\n\r\nexport const TopicDirection = {\r\n  LEFT: 'L', // 从右向左\r\n  RIGHT: 'R', // 从左向右\r\n  BOTTOM: 'B', // 从上往下\r\n  MAIN: 'M' // root\r\n};\r\n\r\nexport enum DiagramLayoutType {\r\n  LEFT_TO_RIGHT,\r\n  RIGHT_TO_LEFT,\r\n  LEFT_AND_RIGHT,\r\n  TOP_TO_BOTTOM\r\n}\r\n\r\nexport const ViewModeMindMap = 'MindMap';\r\n\r\nexport const TopicVisualLevel = {\r\n  ROOT: 0,\r\n  PRIMARY: 1,\r\n  NORMAL: 2\r\n};\r\n\r\nexport const BlockType = {\r\n  CONTENT: 'CONTENT',\r\n  DESC: 'DESC'\r\n};\r\n\r\nexport const FocusMode = {\r\n  NORMAL: 'NORMAL',\r\n  EDITING_CONTENT: 'EDITING_CONTENT',\r\n  EDITING_DESC: 'EDITING_DESC',\r\n  SHOW_POPUP: 'SHOW_POPUP',\r\n  DRAGGING: 'DRAGGING'\r\n};\r\n\r\nexport type ModelChangeCallback = () => void;\r\n\r\nexport type OnChangeFunction = (\r\n  model: DocModel,\r\n  callback?: ModelChangeCallback\r\n) => void;\r\n\r\nexport const TopicRelationship = {\r\n  ANCESTOR: 'ANCESTOR',\r\n  DESCENDANT: 'DESCENDANT',\r\n  SIBLING: 'SIBLING',\r\n  NONE: 'NONE'\r\n};\r\n\r\nexport const OpType = {\r\n  ADD_SHEET: 'ADD_SHEET',\r\n  SET_CURRENT_SHEET: 'SET_CURRENT_SHEET',\r\n  DELETE_SHEET: 'DELETE_SHEET',\r\n  DUPLICATE_SHEET: 'DUPLICATE_SHEET',\r\n  SET_SHEET_TITLE: 'SET_SHEET_TITLE',\r\n\r\n\r\n  ADD_MULTI_TOPICS: 'ADD_MULTI_TOPICS',\r\n  ADD_MULTI_SIBLING: 'ADD_MULTI_SIBLING',\r\n  ADD_MULTI_CHILD: 'ADD_MULTI_CHILD',\r\n  ADD_MULTI_CHILD_WITH_EXTDATA: 'ADD_MULTI_CHILD_WITH_EXTDATA',\r\n\r\n  TOGGLE_COLLAPSE: 'TOGGLE_COLLAPSE',\r\n  COLLAPSE_ALL: 'COLLAPSE_ALL',\r\n  EXPAND_ALL: 'EXPAND_ALL',\r\n  EXPAND_TO: 'EXPAND_TO',\r\n  ADD_CHILD: 'ADD_CHILD',\r\n  ADD_SIBLING: 'ADD_SIBLING',\r\n  TOPIC_CONTENT_TO_PLAIN_TEXT: 'TOPIC_CONTENT_TO_PLAIN_TEXT',\r\n  INDENT: 'INDENT',\r\n  OUTDENT: 'OUTDENT',\r\n  DELETE_TOPIC: 'DELETE_TOPIC',\r\n  FOCUS_TOPIC: 'FOCUS_TOPIC',\r\n  SET_FOCUS_MODE: 'SET_FOCUS_MODE',\r\n  SET_STYLE: 'SET_STYLE',\r\n  CLEAR_ALL_CUSTOM_STYLE: 'CLEAR_ALL_CUSTOM_STYLE',\r\n  SET_CONFIG: 'SET_CONFIG',\r\n  SET_THEME: 'SET_THEME',\r\n  SET_TOPIC_BLOCK: 'SET_TOPIC_BLOCK',\r\n  DELETE_TOPIC_BLOCK: 'DELETE_TOPIC_BLOCK',\r\n  // 节流函数使用，使用时不可以undo\r\n  SET_TOPIC_BLOCK_CONTENT: 'SET_TOPIC_BLOCK_CONTENT',\r\n  // SET_TOPIC_BLOCK_DESC: 'SET_TOPIC_BLOCK_DESC',\r\n  // DELETE_TOPIC_BLOCK_DESC: 'DELETE_TOPIC_BLOCK_DESC',\r\n  // SET_TOPIC_CONTENT: 'SET_TOPIC_CONTENT',\r\n  // SET_TOPIC_DESC: 'SET_TOPIC_DESC',\r\n  START_EDITING_CONTENT: 'START_EDITING_CONTENT',\r\n  START_EDITING_DESC: 'START_EDITING_DESC',\r\n  DRAG_AND_DROP: 'DRAG_AND_DROP',\r\n  SET_EDITOR_ROOT: 'SET_EDITOR_ROOT',\r\n  SET_LAYOUT_DIR: 'SET_LAYOUT_DIR',\r\n  SWAP_UP: 'SWAP_UP',\r\n  SWAP_DOWN: 'SWAP_DOWN'\r\n};\r\n","import { List, Record } from 'immutable';\r\nimport { KeyType } from '../types';\r\n\r\ntype BlockRecordType = {\r\n  type: string;\r\n  key?: KeyType;\r\n  data: any;\r\n};\r\n\r\nconst defaultBlockRecord: BlockRecordType = {\r\n  type: null,\r\n  key: null,\r\n  data: null\r\n};\r\n\r\nexport class Block extends Record(defaultBlockRecord) {\r\n  get data(): any {\r\n    return this.get('data');\r\n  }\r\n\r\n  get type(): string {\r\n    return this.get('type');\r\n  }\r\n\r\n  static create(obj: BlockRecordType): Block {\r\n    return new Block(obj);\r\n  }\r\n\r\n  static createList(obj: any): List<Block> {\r\n    if (List.isList(obj) || Array.isArray(obj)) {\r\n      // @ts-ignore\r\n      return List(obj.map(Block.create));\r\n    }\r\n    throw new Error(\r\n      `Block.createList only accepts Array or List, but you passed it: ${obj}`\r\n    );\r\n  }\r\n}\r\n","export type LinkLineType = 'line' | 'curve' | 'round';\r\nexport type LinkStyle = {\r\n  lineType?: string;\r\n  hasUnderline?: boolean;\r\n  lineWidth?: string;\r\n  lineColor?: string;\r\n  lineRadius?: number;\r\n};\r\n\r\nexport type TopicContentStyle = {\r\n  [key: string]: any;\r\n  background?: string;\r\n  color?: string;\r\n  fontFamily?: string;\r\n  fontSize?: string;\r\n  lineHeight?: string;\r\n  border?: string;\r\n  borderRadius?: string;\r\n  borderWidth?: string;\r\n  borderStyle?: string;\r\n  borderColor?: string;\r\n  padding?: string;\r\n};\r\n\r\nexport type TopicStyle = {\r\n  contentStyle?: TopicContentStyle;\r\n  linkStyle?: LinkStyle;\r\n  subLinkStyle?: LinkStyle;\r\n};\r\n\r\nexport type ThemeType = {\r\n  name: string;\r\n  background: string;\r\n  highlightColor: string;\r\n  randomColor?: boolean;\r\n  marginH: number;\r\n  marginV: number;\r\n\r\n  contentStyle?: TopicContentStyle;\r\n  linkStyle?: LinkStyle;\r\n\r\n  rootTopic?: TopicStyle;\r\n  primaryTopic?: TopicStyle;\r\n  normalTopic?: TopicStyle;\r\n};\r\n\r\nexport function isThemeType(obj: any): boolean {\r\n  return (\r\n    obj.name != null && obj.background != null && obj.highlightColor != null\r\n  );\r\n}\r\n\r\nexport interface Themes {\r\n  [fieldName: string]: ThemeType;\r\n}\r\n","import { ThemeType } from './types';\r\n\r\nexport const defaultTheme: ThemeType = {\r\n  name: 'defaultTheme',\r\n  randomColor: false,\r\n  background: '#DDDDDD',\r\n  highlightColor: '#C31004',\r\n  marginH: 50,\r\n  marginV: 5,\r\n  contentStyle: {\r\n    lineHeight: '1'\r\n  },\r\n\r\n  linkStyle: {\r\n    lineRadius: 5,\r\n    lineWidth: '2px',\r\n    lineColor: '#595959',\r\n    lineType: 'curve'\r\n  },\r\n\r\n  rootTopic: {\r\n    contentStyle: {\r\n      background: '#C31004',\r\n      color: '#fff',\r\n      fontSize: '34px',\r\n      borderRadius: '5px',\r\n      padding: '16px 18px 16px 18px'\r\n    },\r\n    subLinkStyle: {\r\n      lineType: 'curve'\r\n    }\r\n  },\r\n  primaryTopic: {\r\n    contentStyle: {\r\n      background: '#333',\r\n      borderRadius: '5px',\r\n      color: '#fff',\r\n      fontSize: '14px',\r\n      padding: '6px 10px 5px 10px'\r\n    },\r\n\r\n    subLinkStyle: {\r\n      hasUnderline: true,\r\n      lineType: 'round'\r\n    }\r\n  },\r\n\r\n  normalTopic: {\r\n    contentStyle: {\r\n      borderRadius: '5px',\r\n      background: '#fff0',\r\n      color: '#383833',\r\n      fontSize: '13px',\r\n      padding: '1px'\r\n    },\r\n\r\n    subLinkStyle: {\r\n      hasUnderline: true,\r\n      lineType: 'round'\r\n    }\r\n  }\r\n};\r\n","import { Record } from 'immutable';\r\nimport { defaultTheme, ThemeType } from '../configs/theme';\r\nimport { DiagramLayoutType, ViewModeMindMap } from '../types';\r\n\r\nexport type ConfigRecordType = {\r\n  viewMode: string;\r\n  readOnly?: boolean;\r\n  allowUndo?: boolean;\r\n  layoutDir?: DiagramLayoutType;\r\n  theme?: ThemeType;\r\n};\r\n\r\nconst defaultConfigRecord: ConfigRecordType = {\r\n  viewMode: ViewModeMindMap,\r\n  readOnly: false,\r\n  allowUndo: true,\r\n  layoutDir: DiagramLayoutType.LEFT_TO_RIGHT,\r\n  theme: defaultTheme\r\n};\r\n\r\nexport class Config extends Record(defaultConfigRecord) {\r\n  get viewMode(): string {\r\n    return this.get('viewMode');\r\n  }\r\n\r\n  get layoutDir(): DiagramLayoutType {\r\n    return this.get('layoutDir');\r\n  }\r\n\r\n  get readOnly(): boolean {\r\n    return this.get('readOnly');\r\n  }\r\n\r\n  get allowUndo(): boolean {\r\n    return this.get('allowUndo');\r\n  }\r\n\r\n  get theme(): ThemeType {\r\n    return this.get('theme');\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    return new Config(obj);\r\n  }\r\n}\r\n","import { List, Record } from 'immutable';\r\nimport { BlockType, KeyType } from '../types';\r\nimport { Block } from './block';\r\nimport { Relation } from './relation';\r\n\r\ntype TopicRecordType = {\r\n  key: KeyType;\r\n  parentKey?: KeyType;\r\n  collapse?: boolean;\r\n  subKeys?: List<KeyType>;\r\n  blocks?: List<Block>;\r\n  relations?: List<Relation>;\r\n  style?: string;\r\n};\r\n\r\ntype CreateTopicArg = {\r\n  key: KeyType;\r\n  parentKey?: KeyType;\r\n  collapse?: boolean;\r\n  content?: any;\r\n  subKeys?: List<KeyType> | KeyType[];\r\n  style?: string;\r\n};\r\n\r\nconst defaultTopicRecord: TopicRecordType = {\r\n  key: null,\r\n  parentKey: null,\r\n  collapse: false,\r\n  subKeys: null,\r\n  blocks: null,\r\n  relations: null,\r\n  style: null\r\n};\r\n\r\nexport class Topic extends Record(defaultTopicRecord) {\r\n  get key() {\r\n    return this.get('key');\r\n  }\r\n  get parentKey() {\r\n    return this.get('parentKey');\r\n  }\r\n  get collapse() {\r\n    return this.get('collapse');\r\n  }\r\n  get subKeys(): List<KeyType> {\r\n    return this.get('subKeys');\r\n  }\r\n  get blocks(): List<Block> {\r\n    return this.get('blocks');\r\n  }\r\n  get relations() {\r\n    return this.get('relations');\r\n  }\r\n  get style() {\r\n    return this.get('style');\r\n  }\r\n\r\n  getBlock(type: string): { index: number; block: Block } {\r\n    const index = this.blocks.findIndex(b => b.type === type);\r\n    if (index === -1) return { index, block: null };\r\n    return { index, block: this.blocks.get(index) };\r\n  }\r\n\r\n  get contentData() {\r\n    return this.getBlock(BlockType.CONTENT).block.data;\r\n  }\r\n\r\n  static fromJSON(obj) {\r\n    const {\r\n      key,\r\n      parentKey = null,\r\n      blocks,\r\n      subKeys = [],\r\n      collapse = false\r\n    } = obj;\r\n    return new Topic({\r\n      key,\r\n      parentKey,\r\n      collapse,\r\n      subKeys: List(subKeys),\r\n      blocks: Block.createList(blocks)\r\n    });\r\n  }\r\n\r\n  static create({\r\n    key,\r\n    parentKey = null,\r\n    content = '',\r\n    subKeys = [],\r\n    collapse = false\r\n  }: CreateTopicArg): Topic {\r\n    const block = Block.create({\r\n      type: BlockType.CONTENT,\r\n      data: content,\r\n      key: null\r\n    });\r\n    const blocks = List([block]);\r\n    return new Topic({\r\n      key,\r\n      parentKey,\r\n      blocks,\r\n      subKeys: List(subKeys),\r\n      collapse\r\n    });\r\n  }\r\n}\r\n","import { Record } from 'immutable';\r\n\r\ntype DescBlockDataRecordType = {\r\n  kind: string;\r\n  data: any;\r\n  collapse: boolean;\r\n};\r\n\r\nconst defaultDescBlockDataRecord: DescBlockDataRecordType = {\r\n  kind: null,\r\n  data: null,\r\n  collapse: false\r\n};\r\n\r\nexport class DescBlockData extends Record(defaultDescBlockDataRecord) {\r\n  get kind() {\r\n    return this.get('kind');\r\n  }\r\n\r\n  get data() {\r\n    return this.get('data');\r\n  }\r\n\r\n  get collapse() {\r\n    return this.get('collapse');\r\n  }\r\n}\r\n","import { KeyPath, KeyType, TopicRelationship } from '../../types';\r\nimport { SheetModel } from '../sheet-model';\r\n\r\nexport function getAllSubTopicKeys(\r\n  model: SheetModel,\r\n  topicKey: KeyType\r\n): KeyType[] {\r\n  const item = model.getTopic(topicKey);\r\n\r\n  let res = [];\r\n  if (item.subKeys.size > 0) {\r\n    const subKeys = item.subKeys.toArray();\r\n    res.push(...subKeys);\r\n    res = subKeys.reduce((acc, key) => {\r\n      acc.push(...getAllSubTopicKeys(model, key));\r\n      return acc;\r\n    }, res);\r\n  }\r\n  return res;\r\n}\r\n\r\nexport function getKeyPath(\r\n  model: SheetModel,\r\n  topicKey: KeyType,\r\n  reverse: boolean = false\r\n): KeyPath {\r\n  const res = [topicKey];\r\n  let item = model.getTopic(topicKey);\r\n  while (item.parentKey) {\r\n    reverse ? res.push(item.parentKey) : res.unshift(item.parentKey);\r\n    item = model.getParentTopic(item.key);\r\n  }\r\n  return res;\r\n}\r\n\r\nexport function getRelationship(\r\n  model: SheetModel,\r\n  srcKey: KeyType,\r\n  dstKey: KeyType\r\n): string {\r\n  const srcTopic = model.getTopic(srcKey);\r\n  const dstTopic = model.getTopic(dstKey);\r\n  if (srcTopic && dstTopic) {\r\n    if (srcTopic.parentKey == dstTopic.parentKey)\r\n      return TopicRelationship.SIBLING;\r\n    let pTopic = srcTopic;\r\n    while (pTopic.parentKey) {\r\n      if (pTopic.parentKey === dstTopic.key)\r\n        return TopicRelationship.DESCENDANT;\r\n      pTopic = model.getParentTopic(pTopic.key);\r\n    }\r\n    pTopic = dstTopic;\r\n    while (pTopic.parentKey) {\r\n      if (pTopic.parentKey === srcTopic.key) return TopicRelationship.ANCESTOR;\r\n      pTopic = model.getParentTopic(pTopic.key);\r\n    }\r\n  }\r\n  return TopicRelationship.NONE;\r\n}\r\n\r\nexport function getPrevTopicKey(model: SheetModel, topicKey: KeyType) {\r\n  const parentTopic = model.getParentTopic(topicKey);\r\n  if (parentTopic) {\r\n    const index = parentTopic.subKeys.indexOf(topicKey);\r\n    if (index === 0) {\r\n      return parentTopic.key;\r\n    }\r\n    return parentTopic.subKeys.get(index - 1);\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getNextTopicKey(model: SheetModel, topicKey: KeyType) {}\r\n\r\n// 判断该topic是否为其父亲的第一个孩子\r\nexport function isFisrtChild(model: SheetModel, topicKey: KeyType) {\r\n  const parentTopic = model.getParentTopic(topicKey);\r\n  if (parentTopic) {\r\n    const index = parentTopic.subKeys.indexOf(topicKey);\r\n    if (index === 0) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function isSibling(\r\n  model: SheetModel,\r\n  key1: KeyType,\r\n  key2: KeyType\r\n): boolean {\r\n  return model.getParentTopic(key1) === model.getParentTopic(key2);\r\n}\r\n\r\n/**\r\n * 根据当前元素的Key,获取depth=depth的祖先的key\r\n * @param model\r\n * @param key\r\n * @param depth\r\n */\r\nexport function getAncestorKeyByDepth(\r\n  model: SheetModel,\r\n  key: KeyType,\r\n  depth: number\r\n) {\r\n  let curDepth = model.getDepth(key);\r\n  if (curDepth === depth) return key;\r\n  if (curDepth < depth) return null;\r\n  while (curDepth > depth) {\r\n    key = model.getParentKey(key);\r\n    curDepth--;\r\n  }\r\n  return key;\r\n}\r\n\r\n/**\r\n * 找到他们互为sibling的祖先的Key,返回一个数组里面有两个祖先的key\r\n * @param model\r\n * @param key1\r\n * @param key2\r\n */\r\nexport function getSiblingAncestorKeys(\r\n  model: SheetModel,\r\n  key1: KeyType,\r\n  key2: KeyType\r\n): Array<KeyType> {\r\n  const d1 = model.getDepth(key1);\r\n  const d2 = model.getDepth(key2);\r\n  if (d1 === d2) {\r\n    if (isSibling(model, key1, key2)) return [key1, key2];\r\n    return getSiblingAncestorKeys(\r\n      model,\r\n      model.getParentKey(key1),\r\n      model.getParentKey(key2)\r\n    );\r\n  }\r\n  return d1 > d2\r\n    ? getSiblingAncestorKeys(\r\n        model,\r\n        getAncestorKeyByDepth(model, key1, d2),\r\n        key2\r\n      )\r\n    : getSiblingAncestorKeys(\r\n        model,\r\n        key1,\r\n        getAncestorKeyByDepth(model, key2, d1)\r\n      );\r\n}\r\n\r\n/**\r\n * 获取从subKey1到subKey2之间的subKeys,前提是 subKey1和subKey2的父亲相同\r\n * @param model\r\n * @param subKey1\r\n * @param subKey2\r\n */\r\nexport function getRangeSubKeys(\r\n  model: SheetModel,\r\n  subKey1: KeyType,\r\n  subKey2: KeyType\r\n): Array<KeyType> {\r\n  const topic = model.getParentTopic(subKey1);\r\n  const subKeys = topic.subKeys;\r\n  const i1 = subKeys.indexOf(subKey1);\r\n  const i2 = subKeys.indexOf(subKey2);\r\n  if (i1 < 0 || i2 < 0)\r\n    throw new Error(\r\n      `The parent of subKey1 ${subKey1} and subKey2 ${subKey2} is not same`\r\n    );\r\n  return (i1 < i2\r\n    ? subKeys.slice(i1, i2 + 1)\r\n    : subKeys.slice(i2, i1 + 1)\r\n  ).toArray();\r\n}\r\n\r\n/**\r\n * 获取最底层最下面的后代的Key, 如果该项没有子元素，则返回自己的key\r\n * @param model\r\n * @param key\r\n */\r\nexport function getBottomDescendantKey(\r\n  model: SheetModel,\r\n  key: KeyType\r\n): KeyType {\r\n  const topic = model.getTopic(key);\r\n  return topic.subKeys.size === 0\r\n    ? key\r\n    : //@ts-ignore\r\n      getBottomDescendantKey(model, topic.subKeys.last());\r\n}\r\n\r\n/**\r\n * 获取最底层最下面的后代的Key, 需要考虑折叠, 如果该项没有子元素，则返回自己的key\r\n * @param model\r\n * @param key\r\n */\r\nexport function getVisualBottomDescendantKey(\r\n  model: SheetModel,\r\n  key: KeyType\r\n): KeyType {\r\n  const topic = model.getTopic(key);\r\n  return topic.subKeys.size === 0 || topic.collapse\r\n    ? key\r\n    : //@ts-ignore\r\n      getVisualBottomDescendantKey(model, topic.subKeys.last());\r\n}\r\n\r\n/**\r\n * 是否都是Sibiling\r\n * @param model\r\n * @param keys\r\n */\r\nexport function isAllSibiling(model: SheetModel, keys: Array<KeyType>) {\r\n  if (keys && keys.length > 0) {\r\n    const parentKey = model.getParentKey(keys[0]);\r\n    for (const key of keys) {\r\n      if (model.getParentKey(key) !== parentKey) return false;\r\n    }\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n","export function createKey() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n    const r = (Math.random() * 16) | 0,\r\n      v = c === 'x' ? r : (r & 0x3) | 0x8;\r\n    return v.toString(16);\r\n  });\r\n}\r\n","import debug from 'debug';\r\nimport htmlToText from 'html-to-text';\r\nimport { List } from 'immutable';\r\nimport { ThemeType } from '../configs/theme';\r\nimport {\r\n  BlockType,\r\n  DiagramLayoutType,\r\n  FocusMode,\r\n  KeyType,\r\n  TopicRelationship\r\n} from '../types';\r\nimport { createKey } from '../utils';\r\nimport { Block } from './block';\r\nimport { Config, ConfigRecordType } from './config';\r\nimport { DescBlockData } from './desc-block-data';\r\nimport { SheetModel } from './sheet-model';\r\nimport { Topic } from './topic';\r\nimport {\r\n  getAllSubTopicKeys,\r\n  getKeyPath,\r\n  getPrevTopicKey,\r\n  getRelationship\r\n} from './utils';\r\n\r\nconst log = debug('modifier');\r\n\r\ntype ModifierArg =\r\n  | BaseSheetModelModifierArg\r\n  | SetTopicArg\r\n  | setTopicBlockDataArg\r\n  | SetFocusModeArg\r\n  | SetTopicStyleArg\r\n  | SetZoomFactorArg\r\n  | SetThemeArg\r\n  | SetLayoutDirArg\r\n  | SetConfigArg;\r\n\r\nexport type BaseSheetModelModifierArg = {\r\n  model: SheetModel;\r\n  topicKey?: KeyType;\r\n  topicKeys?: Array<KeyType>;\r\n};\r\n\r\ntype SetTopicArg = BaseSheetModelModifierArg & {\r\n  topic: Topic;\r\n};\r\n\r\ntype setTopicBlockDataArg = BaseSheetModelModifierArg & {\r\n  blockType: string;\r\n  data: any;\r\n  focusMode?: string;\r\n};\r\n\r\ntype DeleteTopicBlockArg = BaseSheetModelModifierArg & {\r\n  blockType: string;\r\n};\r\n\r\ntype SetFocusModeArg = BaseSheetModelModifierArg & {\r\n  focusMode: string;\r\n};\r\n\r\ntype SetTopicStyleArg = BaseSheetModelModifierArg & {\r\n  style: string;\r\n};\r\n\r\ntype SetZoomFactorArg = BaseSheetModelModifierArg & {\r\n  zoomFactor: number;\r\n};\r\n\r\ntype SetThemeArg = BaseSheetModelModifierArg & {\r\n  theme: ThemeType;\r\n};\r\n\r\ntype SetLayoutDirArg = BaseSheetModelModifierArg & {\r\n  layoutDir: DiagramLayoutType;\r\n};\r\n\r\ntype SetConfigArg = BaseSheetModelModifierArg & {\r\n  config: Partial<ConfigRecordType>;\r\n};\r\n\r\nexport type SheetModelModifierResult = SheetModel;\r\n\r\nfunction toggleCollapse({\r\n  model,\r\n  topicKey\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  let topic = model.getTopic(topicKey);\r\n  if (topic && topic.subKeys.size !== 0) {\r\n    topic = topic.merge({\r\n      collapse: !topic.collapse\r\n    });\r\n    model = model.updateIn(\r\n      ['topics', topic.key, 'collapse'],\r\n      collapse => !collapse\r\n    );\r\n  }\r\n  model = focusTopic({ model, topicKey, focusMode: FocusMode.NORMAL });\r\n  return model;\r\n}\r\n\r\nfunction collapseAll({\r\n  model\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  const topicKeys = getAllSubTopicKeys(model, model.editorRootTopicKey);\r\n  log(model);\r\n  model = model.withMutations(m => {\r\n    topicKeys.forEach(topicKey => {\r\n      m.setIn(['topics', topicKey, 'collapse'], true);\r\n    });\r\n  });\r\n  model = focusTopic({\r\n    model,\r\n    topicKey: model.editorRootTopicKey,\r\n    focusMode: FocusMode.NORMAL\r\n  });\r\n  return model;\r\n}\r\n\r\nfunction expandAll({\r\n  model\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  const topicKeys = getAllSubTopicKeys(model, model.editorRootTopicKey);\r\n  log(model);\r\n  model = model.withMutations(m => {\r\n    topicKeys.forEach(topicKey => {\r\n      m.setIn(['topics', topicKey, 'collapse'], false);\r\n    });\r\n  });\r\n  log(model);\r\n  return model;\r\n}\r\n\r\nfunction expandTo({\r\n  model,\r\n  topicKey\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  const keys = getKeyPath(model, topicKey).filter(t => t !== topicKey);\r\n  model = model.withMutations(m => {\r\n    keys.forEach(topicKey => {\r\n      m.setIn(['topics', topicKey, 'collapse'], false);\r\n    });\r\n  });\r\n  // 要让这个节点在视口中可见\r\n  if (\r\n    getRelationship(model, topicKey, model.editorRootTopicKey) !==\r\n    TopicRelationship.DESCENDANT\r\n  ) {\r\n    model = model.set('editorRootTopicKey', model.rootTopicKey);\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction focusTopic({\r\n  model,\r\n  topicKey,\r\n  focusMode = FocusMode.NORMAL\r\n}: SetFocusModeArg): SheetModelModifierResult {\r\n  log('focus topic', focusMode);\r\n  if (!model.topics.has(topicKey)) {\r\n    throw new Error(`focus key ${topicKey} is not in model`);\r\n  }\r\n  if (topicKey !== model.focusKey) model = model.set('focusKey', topicKey);\r\n  // if (focusMode !== model.focusMode) model = model.set('focusMode', focusMode);\r\n  model = model.set('focusMode', focusMode);\r\n  if (model.selectedKeys != null) model = model.set('selectedKeys', null);\r\n  return model;\r\n}\r\n\r\nfunction setFocusMode({\r\n  model,\r\n  focusMode\r\n}: SetFocusModeArg): SheetModelModifierResult {\r\n  log('setFocusMode');\r\n  // SHOW_POPUP一定要重新设置, 因为可能dialogType 改变了\r\n  if (focusMode !== model.focusMode || focusMode === FocusMode.SHOW_POPUP)\r\n    model = model.set('focusMode', focusMode);\r\n  return model;\r\n}\r\n\r\nfunction addChild({\r\n  model,\r\n  topicKey,\r\n  addAtFront = false\r\n}: BaseSheetModelModifierArg & {\r\n  addAtFront: boolean;\r\n}): SheetModelModifierResult {\r\n  log('addChild:', topicKey);\r\n  let topic = model.getTopic(topicKey);\r\n  if (topic) {\r\n    const child = Topic.create({ key: createKey(), parentKey: topic.key });\r\n    topic = topic\r\n      .set('collapse', false)\r\n      .update('subKeys', subKeys =>\r\n        addAtFront ? subKeys.unshift(child.key) : subKeys.push(child.key)\r\n      );\r\n    model = model.update('topics', topics =>\r\n      topics.set(topicKey, topic).set(child.key, child)\r\n    );\r\n    return focusTopic({\r\n      model,\r\n      topicKey: child.key,\r\n      focusMode: FocusMode.EDITING_CONTENT\r\n    });\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction addSibling({\r\n  model,\r\n  topicKey,\r\n  content\r\n}: BaseSheetModelModifierArg & {\r\n  content?: string;\r\n}): SheetModelModifierResult {\r\n  if (topicKey === model.rootTopicKey) return model;\r\n  const topic = model.getTopic(topicKey);\r\n  if (topic) {\r\n    const pItem = model.getTopic(topic.parentKey);\r\n    const idx = pItem.subKeys.indexOf(topicKey);\r\n    const sibling = Topic.create({\r\n      key: createKey(),\r\n      parentKey: pItem.key,\r\n      content\r\n    });\r\n    model = model\r\n      .update('topics', topics => topics.set(sibling.key, sibling))\r\n      .updateIn(['topics', pItem.key, 'subKeys'], subKeys =>\r\n        subKeys.insert(idx + 1, sibling.key)\r\n      );\r\n    return focusTopic({\r\n      model,\r\n      topicKey: sibling.key,\r\n      focusMode: FocusMode.EDITING_CONTENT\r\n    });\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction topicContentToPlainText({\r\n  model,\r\n  topicKey\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  const content = model.getTopic(topicKey).getBlock(BlockType.CONTENT).block\r\n    .data;\r\n  const data = htmlToText.fromString(content, { preserveNewlines: true });\r\n  return setTopicBlockContentData({ model, topicKey, data });\r\n}\r\n\r\nfunction deleteTopic({\r\n  model,\r\n  topicKey\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  if (topicKey === model.editorRootTopicKey) return model;\r\n  const item = model.getTopic(topicKey);\r\n  if (item) {\r\n    model = model.withMutations(m => {\r\n      m.update('topics', topics => {\r\n        topics = topics.delete(topicKey);\r\n        const deleteKeys = getAllSubTopicKeys(model, topicKey);\r\n        topics = topics.withMutations(t => {\r\n          deleteKeys.forEach(dKey => {\r\n            t.delete(dKey);\r\n          });\r\n        });\r\n        return topics;\r\n      });\r\n      m.updateIn(['topics', item.parentKey, 'subKeys'], subKeys =>\r\n        subKeys.delete(subKeys.indexOf(topicKey))\r\n      );\r\n      if (m.focusKey === topicKey)\r\n        m.set('focusKey', getPrevTopicKey(model, topicKey)).set(\r\n          'focusMode',\r\n          FocusMode.EDITING_CONTENT\r\n        );\r\n    });\r\n  }\r\n\r\n  return model;\r\n}\r\n\r\nfunction deleteTopics({ model, topicKeys }): SheetModelModifierResult {\r\n  if (topicKeys == null) topicKeys = model.focusOrSelectedKeys;\r\n  topicKeys.forEach(topicKey => {\r\n    model = deleteTopic({ model, topicKey });\r\n  });\r\n  return model;\r\n}\r\n\r\n/**\r\n * setTopicBlockData of one topic\r\n * @param model\r\n * @param topicKey\r\n * @param blockType\r\n * @param focusMode\r\n * @param data\r\n */\r\nfunction setTopicBlockData({\r\n  model,\r\n  topicKey,\r\n  blockType,\r\n  focusMode,\r\n  data\r\n}: setTopicBlockDataArg): SheetModelModifierResult {\r\n  const topic = model.getTopic(topicKey);\r\n  if (topic) {\r\n    const { index, block } = topic.getBlock(blockType);\r\n    if (index === -1) {\r\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\r\n        blocks.push(\r\n          Block.create({\r\n            type: blockType,\r\n            data: data\r\n          })\r\n        )\r\n      );\r\n    } else {\r\n      if (block.data !== data) {\r\n        model = model.updateIn(\r\n          ['topics', topicKey, 'blocks', index, 'data'],\r\n          dt => data\r\n        );\r\n      }\r\n    }\r\n    if (focusMode) {\r\n      model = focusTopic({\r\n        model,\r\n        topicKey,\r\n        focusMode\r\n      });\r\n    }\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction setTopicBlockContentData({\r\n  model,\r\n  topicKey,\r\n  focusMode = null,\r\n  data\r\n}): SheetModelModifierResult {\r\n  return setTopicBlockData({\r\n    model,\r\n    topicKey,\r\n    focusMode,\r\n    data,\r\n    blockType: BlockType.CONTENT\r\n  });\r\n}\r\n\r\nfunction deleteTopicBlock({ model, topicKey, blockType }: DeleteTopicBlockArg) {\r\n  const topic = model.getTopic(topicKey);\r\n  if (topic) {\r\n    const { index } = topic.getBlock(blockType);\r\n    if (index !== -1) {\r\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\r\n        blocks.delete(index)\r\n      );\r\n    }\r\n    model = setFocusMode({\r\n      model,\r\n      focusMode: FocusMode.NORMAL\r\n    });\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction deleteTopicBlockDesc({ model, topicKey }: BaseSheetModelModifierArg) {\r\n  return deleteTopicBlock({ model, topicKey, blockType: BlockType.DESC });\r\n}\r\n\r\nfunction setStyle({\r\n  model,\r\n  topicKey,\r\n  style\r\n}: SetTopicStyleArg): SheetModelModifierResult {\r\n  const topic = model.getTopic(topicKey);\r\n  if (topic) {\r\n    if (style !== topic.style) {\r\n      model = model.updateIn(['topics', topicKey, 'style'], s => style);\r\n    }\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction clearAllCustomStyle({\r\n  model\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  model = model.withMutations(model => {\r\n    model.topics.keySeq().forEach(key => {\r\n      model.setIn(['topics', key, 'style'], null);\r\n    });\r\n  });\r\n  return model;\r\n}\r\n\r\nfunction setTheme({ model, theme }: SetThemeArg): SheetModelModifierResult {\r\n  model = model.setIn(['config', 'theme'], theme);\r\n  return model;\r\n}\r\n\r\nfunction setLayoutDir({\r\n  model,\r\n  layoutDir\r\n}: SetLayoutDirArg): SheetModelModifierResult {\r\n  if (model.config.layoutDir === layoutDir) return model;\r\n  model = model.setIn(['config', 'layoutDir'], layoutDir);\r\n  return model;\r\n}\r\n\r\nfunction setConfig({ model, config }: SetConfigArg) {\r\n  return model.set('config', model.config.merge(config));\r\n}\r\n\r\nfunction setEditorRootTopicKey({\r\n  model,\r\n  topicKey\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  if (model.editorRootTopicKey !== topicKey)\r\n    model = model.set('editorRootTopicKey', topicKey);\r\n  if (model.getTopic(topicKey).collapse)\r\n    model = model.setIn(['topics', topicKey, 'collapse'], false);\r\n  return model;\r\n}\r\n\r\nfunction setZoomFactor({\r\n  model,\r\n  zoomFactor\r\n}: SetZoomFactorArg): SheetModelModifierResult {\r\n  if (model.zoomFactor !== zoomFactor)\r\n    model = model.set('zoomFactor', zoomFactor);\r\n  return model;\r\n}\r\n\r\nfunction startEditingContent({ model, topicKey }: BaseSheetModelModifierArg) {\r\n  return focusTopic({\r\n    model,\r\n    topicKey,\r\n    focusMode: FocusMode.EDITING_CONTENT\r\n  });\r\n}\r\nfunction startEditingDesc({ model, topicKey }: BaseSheetModelModifierArg) {\r\n  const topic = model.getTopic(topicKey);\r\n  const desc = topic.getBlock(BlockType.DESC);\r\n  if (desc.block == null || desc.block.data == null) {\r\n    model = SheetModelModifier.setTopicBlockData({\r\n      model,\r\n      topicKey,\r\n      blockType: BlockType.DESC,\r\n      data: new DescBlockData({ kind: 'html', data: '', collapse: false })\r\n    });\r\n  }\r\n  model = SheetModelModifier.focusTopic({\r\n    model,\r\n    topicKey,\r\n    focusMode: FocusMode.EDITING_DESC\r\n  });\r\n  return model;\r\n}\r\n\r\nfunction dragAndDrop({ model, srcKey, dstKey, dropDir }) {\r\n  const srcTopic = model.getTopic(srcKey);\r\n  const dstTopic = model.getTopic(dstKey);\r\n\r\n  const srcParentKey = srcTopic.parentKey;\r\n  const srcParentTopic = model.getTopic(srcParentKey);\r\n  let srcParentSubKeys = srcParentTopic.subKeys;\r\n  const srcIndex = srcParentSubKeys.indexOf(srcKey);\r\n\r\n  srcParentSubKeys = srcParentSubKeys.delete(srcIndex);\r\n\r\n  if (dropDir === 'in') {\r\n    let dstSubKeys = dstTopic.subKeys;\r\n    dstSubKeys = dstSubKeys.push(srcKey);\r\n    model = model.withMutations(m => {\r\n      m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys)\r\n        .setIn(['topics', srcKey, 'parentKey'], dstKey)\r\n        .setIn(['topics', dstKey, 'subKeys'], dstSubKeys)\r\n        .setIn(['topics', dstKey, 'collapse'], false);\r\n    });\r\n  } else {\r\n    const dstParentKey = dstTopic.parentKey;\r\n    const dstParentItem = model.getTopic(dstParentKey);\r\n    let dstParentSubKeys = dstParentItem.subKeys;\r\n    const dstIndex = dstParentSubKeys.indexOf(dstKey);\r\n    //src 和 dst 的父亲相同，这种情况要做特殊处理\r\n    if (srcParentKey === dstParentKey) {\r\n      let newDstParentSubKeys = List();\r\n      dstParentSubKeys.forEach(key => {\r\n        if (key !== srcKey) {\r\n          if (key === dstKey) {\r\n            if (dropDir === 'prev') {\r\n              newDstParentSubKeys = newDstParentSubKeys.push(srcKey).push(key);\r\n            } else {\r\n              newDstParentSubKeys = newDstParentSubKeys.push(key).push(srcKey);\r\n            }\r\n          } else {\r\n            newDstParentSubKeys = newDstParentSubKeys.push(key);\r\n          }\r\n        }\r\n      });\r\n      model = model.withMutations(m => {\r\n        m.setIn(['topics', dstParentKey, 'subKeys'], newDstParentSubKeys);\r\n      });\r\n    } else {\r\n      if (dropDir === 'prev') {\r\n        dstParentSubKeys = dstParentSubKeys.insert(dstIndex, srcKey);\r\n      } else if (dropDir === 'next') {\r\n        dstParentSubKeys = dstParentSubKeys.insert(dstIndex + 1, srcKey);\r\n      }\r\n      model = model.withMutations(m => {\r\n        m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys)\r\n          .setIn(['topics', srcKey, 'parentKey'], dstParentKey)\r\n          .setIn(['topics', dstParentKey, 'subKeys'], dstParentSubKeys)\r\n          .setIn(['topics', dstParentKey, 'collapse'], false);\r\n      });\r\n    }\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction swapUp({\r\n  model,\r\n  topicKeys\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  if (topicKeys == null) topicKeys = model.focusOrSelectedKeys;\r\n  const firstKey = topicKeys[0];\r\n  const parent = model.getParentTopic(firstKey);\r\n  const idxArray = [];\r\n\r\n  for (const itemKey of topicKeys) {\r\n    const idx = parent.subKeys.indexOf(itemKey);\r\n    // 如果topicKeys不是sibling 关系\r\n    if (idx === -1) return model;\r\n    idxArray.push(idx);\r\n  }\r\n  // 对序号进行排序\r\n  idxArray.sort((a, b) => a - b);\r\n\r\n  const firstIdx = idxArray[0];\r\n  if (firstIdx === 0) {\r\n    return model;\r\n  } else {\r\n    const sortedItemKeys = idxArray.map(idx => parent.subKeys.get(idx));\r\n    model = model.updateIn(['topics', parent.key, 'subKeys'], subKeys =>\r\n      subKeys\r\n        .splice(idxArray[0], idxArray.length)\r\n        .splice(idxArray[0] - 1, 0, ...sortedItemKeys)\r\n    );\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction swapDown({\r\n  model,\r\n  topicKeys\r\n}: BaseSheetModelModifierArg): SheetModelModifierResult {\r\n  if (topicKeys == null) topicKeys = model.focusOrSelectedKeys;\r\n  const firstKey = topicKeys[0];\r\n  const parent = model.getParentTopic(firstKey);\r\n  const idxArray = [];\r\n\r\n  for (const itemKey of topicKeys) {\r\n    const idx = parent.subKeys.indexOf(itemKey);\r\n    if (idx === -1) return model;\r\n    idxArray.push(idx);\r\n  }\r\n  idxArray.sort((a, b) => a - b);\r\n\r\n  const lastIdx = idxArray[idxArray.length - 1];\r\n  if (lastIdx === parent.subKeys.size - 1) {\r\n    return model;\r\n  } else {\r\n    const sortedItemKeys = idxArray.map(idx => parent.subKeys.get(idx));\r\n    model = model.updateIn(['topics', parent.key, 'subKeys'], subKeys =>\r\n      subKeys\r\n        .splice(idxArray[0], idxArray.length)\r\n        .splice(idxArray[0] + 1, 0, ...sortedItemKeys)\r\n    );\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction addMultiSibling({\r\n  model,\r\n  topicKey,\r\n  contentArray,\r\n  topicArray\r\n}: BaseSheetModelModifierArg & {\r\n  contentArray?: string[];\r\n  topicArray?: Array<Topic>;\r\n}) {\r\n  const topic = model.getTopic(topicKey);\r\n  const parentKey = topic.parentKey;\r\n  const parentTopic = model.getTopic(parentKey);\r\n  const idx = parentTopic.subKeys.indexOf(topicKey);\r\n  if (contentArray) {\r\n    const siblings = contentArray.map(content =>\r\n      Topic.create({\r\n        key: createKey(),\r\n        parentKey,\r\n        content\r\n      })\r\n    );\r\n    const siblingsKeys = siblings.map(s => s.key);\r\n    model = model.withMutations(model => {\r\n      siblings.forEach(sibling => {\r\n        model.update('topics', topics => topics.set(sibling.key, sibling));\r\n      });\r\n      model.updateIn(['topics', parentKey, 'subKeys'], subKeys =>\r\n        subKeys.splice(idx + 1, 0, ...siblingsKeys)\r\n      );\r\n    });\r\n    model = focusTopic({\r\n      model,\r\n      topicKey: siblingsKeys[siblingsKeys.length - 1],\r\n      focusMode: FocusMode.EDITING_CONTENT\r\n    });\r\n  } else if (topicArray) {\r\n  }\r\n  return model;\r\n}\r\n\r\nfunction addMultiChild({\r\n  model,\r\n  topicKey,\r\n  addAtFront = false,\r\n  contentArray,\r\n  topicArray\r\n}: BaseSheetModelModifierArg & {\r\n  addAtFront?: boolean;\r\n  contentArray?: string[];\r\n  topicArray?: Array<Topic>;\r\n}) {\r\n  if (contentArray) {\r\n    topicArray = contentArray.map(content =>\r\n      Topic.create({\r\n        key: createKey(),\r\n        parentKey: topicKey,\r\n        content\r\n      })\r\n    );\r\n  }\r\n\r\n  const childKeys = topicArray\r\n    .filter(s => s.parentKey === topicKey)\r\n    .map(s => s.key);\r\n  model = model.withMutations(model => {\r\n    topicArray.forEach(topic => {\r\n      model.update('topics', topics_ => topics_.set(topic.key, topic));\r\n    });\r\n    model.updateIn(['topics', topicKey, 'subKeys'], subKeys =>\r\n      addAtFront ? subKeys.unshift(...childKeys) : subKeys.push(...childKeys)\r\n    );\r\n  });\r\n  model = focusTopic({\r\n    model,\r\n    topicKey: childKeys[childKeys.length - 1],\r\n    focusMode: FocusMode.EDITING_CONTENT\r\n  });\r\n  return model;\r\n}\r\n\r\nfunction addMultiTopics({ model, topics }) {\r\n  model = model.withMutations(model => {\r\n    topics.forEach(topic => {\r\n      model.update('topics', topics_ => topics_.set(topic.key, topic));\r\n    });\r\n  });\r\n  return model;\r\n}\r\n\r\nexport const SheetModelModifier = {\r\n  addChild,\r\n  addSibling,\r\n  addMultiTopics,\r\n  addMultiChild,\r\n  addMultiSibling,\r\n  toggleCollapse,\r\n  collapseAll,\r\n  expandAll,\r\n  expandTo,\r\n  focusTopic,\r\n  topicContentToPlainText,\r\n  setFocusMode,\r\n  deleteTopic,\r\n  deleteTopics,\r\n  setTopicBlockData,\r\n  setTopicBlockContentData,\r\n  deleteTopicBlock,\r\n  setStyle,\r\n  clearAllCustomStyle,\r\n  setConfig,\r\n  setTheme,\r\n  setLayoutDir,\r\n  setEditorRootTopicKey,\r\n  setZoomFactor,\r\n  startEditingContent,\r\n  startEditingDesc,\r\n  dragAndDrop,\r\n  swapUp,\r\n  swapDown\r\n};\r\n","import debug from 'debug';\r\n\r\nimport { KeyType } from '../types';\r\nimport { DocModel } from './doc-model';\r\nimport { SheetModel } from './sheet-model';\r\nimport { SheetModelModifier } from './sheet-model-modifier';\r\n\r\nconst log = debug('modifier');\r\n\r\nexport type BaseDocModelModifierArg = {\r\n  docModel: DocModel;\r\n  //sheetModel是为了增删sheet使用的\r\n  sheetModel: SheetModel;\r\n  model?: SheetModel;\r\n  topicKey?: KeyType;\r\n};\r\n\r\ntype DocModelModifierResult = DocModel;\r\n\r\nexport function setCurrentSheetModel(\r\n  docModel: DocModel,\r\n  sheetModel: SheetModel\r\n): DocModel {\r\n  if (docModel.currentSheetModel !== sheetModel) {\r\n    docModel = docModel.updateIn(\r\n      ['sheetModels', docModel.currentSheetIndex],\r\n      m => sheetModel\r\n    );\r\n  }\r\n  return docModel;\r\n}\r\n\r\nexport function toDocModelModifierFunc(sheetModelModifierFunc) {\r\n  return arg => {\r\n    const { docModel, ...rest } = arg;\r\n    return setCurrentSheetModel(\r\n      docModel,\r\n      sheetModelModifierFunc({ ...rest, model: docModel.currentSheetModel })\r\n    );\r\n  };\r\n}\r\n\r\nfunction addSheet({\r\n  docModel,\r\n  sheetModel\r\n}: BaseDocModelModifierArg): DocModelModifierResult {\r\n  docModel = docModel.update('sheetModels', sheetModels =>\r\n    sheetModels.push(sheetModel)\r\n  );\r\n  docModel = docModel.set('currentSheetIndex', docModel.sheetModels.size - 1);\r\n  return docModel;\r\n}\r\n\r\nfunction setCurrentSheet({\r\n  docModel,\r\n  sheetIndex = null,\r\n  sheetModel = null,\r\n  sheetId = null\r\n}: BaseDocModelModifierArg & { sheetIndex?: number; sheetId?: KeyType }) {\r\n  if (sheetIndex != null && sheetModel != null) {\r\n    throw new Error('index and sheetModel both not null');\r\n  }\r\n  if (sheetIndex != null && docModel.currentSheetIndex !== sheetIndex) {\r\n    if (sheetIndex >= 0 && sheetIndex < docModel.sheetModels.size) {\r\n      docModel = docModel.set('currentSheetIndex', sheetIndex);\r\n    }\r\n  } else if (sheetModel != null) {\r\n    const idx = docModel.sheetModels.indexOf(sheetModel);\r\n    if (idx === -1) {\r\n      throw new Error('sheetModel is not in docModel');\r\n    }\r\n    docModel = docModel.set('currentSheetIndex', idx);\r\n  } else if (sheetId) {\r\n    const idx = docModel.getSheetIndex(sheetId);\r\n    if (idx === -1) {\r\n      throw new Error('sheetModel is not in docModel');\r\n    }\r\n    docModel = docModel.set('currentSheetIndex', idx);\r\n  }\r\n  return docModel;\r\n}\r\n\r\nfunction duplicateSheet({\r\n  docModel,\r\n  sheetModel,\r\n  title\r\n}: BaseDocModelModifierArg & { title: string }) {\r\n  const idx = docModel.sheetModels.indexOf(sheetModel);\r\n  if (idx === -1) {\r\n    throw new Error('sheetModel is not in docModel');\r\n  }\r\n  docModel = docModel\r\n    .update('sheetModels', sheetModels =>\r\n      sheetModels.insert(idx + 1, sheetModel.set('title', title))\r\n    )\r\n    .set('currentSheetIndex', idx + 1);\r\n  return docModel;\r\n}\r\n\r\nfunction deleteSheet({ docModel, sheetModel }: BaseDocModelModifierArg) {\r\n  const idx = docModel.sheetModels.indexOf(sheetModel);\r\n  if (idx === -1) {\r\n    throw new Error('sheetModel is not in docModel');\r\n  }\r\n  docModel = docModel\r\n    .update('sheetModels', sheetModels => sheetModels.delete(idx))\r\n    .set('currentSheetIndex', 0);\r\n  return docModel;\r\n}\r\n\r\nfunction setSheetTitle({ docModel, title }) {\r\n  docModel = docModel.updateIn(\r\n    ['sheetModels', docModel.currentSheetIndex],\r\n    sheetModel => sheetModel.set('title', title)\r\n  );\r\n  return docModel;\r\n}\r\n\r\nfunction addMultiChildWithExtData({\r\n  docModel,\r\n  topicKey,\r\n  addAtFront = false,\r\n  contentArray,\r\n  topicArray,\r\n  extData\r\n}) {\r\n  docModel = setCurrentSheetModel(\r\n    docModel,\r\n    SheetModelModifier.addMultiChild({\r\n      model: docModel.currentSheetModel,\r\n      topicKey,\r\n      addAtFront,\r\n      contentArray,\r\n      topicArray\r\n    })\r\n  );\r\n  if (extData) docModel = docModel.set('extData', extData);\r\n  return docModel;\r\n}\r\n\r\nconst DocModelModifier: any = {\r\n  addSheet,\r\n  setCurrentSheet,\r\n  duplicateSheet,\r\n  deleteSheet,\r\n  setSheetTitle,\r\n  addMultiChildWithExtData\r\n};\r\n\r\nObject.keys(SheetModelModifier).forEach(k => {\r\n  DocModelModifier[k] = toDocModelModifierFunc(SheetModelModifier[k]);\r\n});\r\n\r\nexport { DocModelModifier };\r\n","import { Map, Record } from 'immutable';\r\nimport isPlainObject from 'is-plain-object';\r\nimport { FocusMode, KeyType } from '../types';\r\nimport { createKey } from '../utils';\r\nimport { Config } from './config';\r\nimport { Topic } from './topic';\r\n\r\ntype ModelRecordType = {\r\n  id: KeyType;\r\n  title: string;\r\n  topics: Map<KeyType, Topic>;\r\n  config: Config;\r\n  rootTopicKey: KeyType;\r\n  editorRootTopicKey?: KeyType;\r\n  focusKey?: KeyType;\r\n  focusMode?: string;\r\n  selectedKeys?: Array<KeyType>;\r\n  zoomFactor: number;\r\n  formatVersion?: string;\r\n};\r\n\r\nconst defaultModelRecord: ModelRecordType = {\r\n  id: null,\r\n  title: null,\r\n  topics: Map(),\r\n  config: new Config(),\r\n  rootTopicKey: null,\r\n  editorRootTopicKey: null,\r\n  focusKey: null,\r\n  focusMode: null,\r\n  zoomFactor: 1,\r\n  selectedKeys: null,\r\n  formatVersion: null\r\n};\r\n\r\nexport class SheetModel extends Record(defaultModelRecord) {\r\n  static isModel(obj) {\r\n    return obj instanceof SheetModel;\r\n  }\r\n  static create(attrs: any = null): SheetModel {\r\n    if (attrs == null) return SheetModel.createEmpty();\r\n    let res: SheetModel;\r\n    if (SheetModel.isModel(attrs)) {\r\n      res = attrs;\r\n    }\r\n\r\n    if (isPlainObject(attrs)) {\r\n      res = SheetModel.fromJSON(attrs);\r\n    }\r\n    if (res) {\r\n      if (res.focusKey == null) {\r\n        res = res.set('focusKey', res.rootTopicKey);\r\n      }\r\n      if (res.focusMode == null) {\r\n        res = res.set('focusMode', FocusMode.NORMAL);\r\n      }\r\n      return res;\r\n    }\r\n\r\n    throw new Error(\r\n      `\\`Value.create\\` only accepts objects or values, but you passed it: ${attrs}`\r\n    );\r\n  }\r\n\r\n  static createEmpty(arg?): SheetModel {\r\n    const model = new SheetModel();\r\n    const rootTopic = Topic.create({ key: createKey(), content: 'RootTopic' });\r\n    return model\r\n      .set('id', createKey())\r\n      .update('topics', topics => topics.set(rootTopic.key, rootTopic))\r\n      .set('rootTopicKey', rootTopic.key)\r\n      .set('editorRootTopicKey', rootTopic.key)\r\n      .set('focusKey', rootTopic.key)\r\n      .set('focusMode', FocusMode.NORMAL)\r\n      .merge(arg);\r\n  }\r\n\r\n  static fromJSON(object) {\r\n    let model = new SheetModel();\r\n    const { topics = [], config = {}, rootTopicKey } = object;\r\n    let { editorRootTopicKey } = object;\r\n\r\n    if (editorRootTopicKey === undefined) editorRootTopicKey = rootTopicKey;\r\n\r\n    model = model.merge({\r\n      rootTopicKey,\r\n      editorRootTopicKey\r\n    });\r\n\r\n    model = model.withMutations(model => {\r\n      topics.forEach(topic => {\r\n        model.update('topics', topics =>\r\n          topics.set(topic.key, Topic.fromJSON(topic))\r\n        );\r\n      });\r\n      model.set('config', Config.fromJSON(config));\r\n    });\r\n\r\n    return model;\r\n  }\r\n\r\n  toJS() {\r\n    return {\r\n      id: this.id,\r\n      title: this.title,\r\n      rootTopicKey: this.rootTopicKey,\r\n      topics: Object.values(this.topics.toJS()),\r\n      config: this.config,\r\n      zoomFactor: this.zoomFactor\r\n    };\r\n  }\r\n\r\n  get id(): KeyType {\r\n    return this.get('id');\r\n  }\r\n\r\n  get title(): string {\r\n    return this.get('title');\r\n  }\r\n\r\n  get topics(): Map<KeyType, Topic> {\r\n    return this.get('topics');\r\n  }\r\n\r\n  get config(): Config {\r\n    return this.get('config');\r\n  }\r\n\r\n  get formatVersion(): string {\r\n    return this.get('formatVersion');\r\n  }\r\n\r\n  get rootTopicKey(): KeyType {\r\n    return this.get('rootTopicKey');\r\n  }\r\n\r\n  get editorRootTopicKey(): KeyType {\r\n    return this.get('editorRootTopicKey');\r\n  }\r\n\r\n  get focusKey(): KeyType {\r\n    return this.get('focusKey');\r\n  }\r\n\r\n  get focusMode(): string {\r\n    return this.get('focusMode');\r\n  }\r\n\r\n  get editingContentKey(): KeyType {\r\n    return [FocusMode.EDITING_CONTENT, FocusMode.SHOW_POPUP].includes(\r\n      this.focusMode\r\n    )\r\n      ? this.focusKey\r\n      : null;\r\n  }\r\n\r\n  get editingDescKey(): KeyType {\r\n    return this.focusMode === FocusMode.EDITING_DESC ? this.focusKey : null;\r\n  }\r\n\r\n  get selectedKeys(): Array<KeyType> {\r\n    return this.get('selectedKeys');\r\n  }\r\n\r\n  get focusOrSelectedKeys(): Array<KeyType> {\r\n    return this.selectedKeys || [this.focusKey];\r\n  }\r\n\r\n  getTopic(key: KeyType): Topic {\r\n    return this.topics.get(key);\r\n  }\r\n\r\n  getParentTopic(key: KeyType): Topic {\r\n    const topic = this.getTopic(key);\r\n    return topic.parentKey ? this.getTopic(topic.parentKey) : null;\r\n  }\r\n\r\n  getParentKey(key: KeyType): KeyType {\r\n    return this.getTopic(key).parentKey;\r\n  }\r\n\r\n  getPreviousSiblingKey(key: KeyType): KeyType {\r\n    const p = this.getParentTopic(key);\r\n    const index = p.subKeys.indexOf(key);\r\n    if (index === 0) return null;\r\n    return p.subKeys.get(index - 1);\r\n  }\r\n\r\n  getNextSiblingKey(key: KeyType): KeyType {\r\n    const p = this.getParentTopic(key);\r\n    const index = p.subKeys.indexOf(key);\r\n    if (index === p.subKeys.size - 1) return null;\r\n    return p.subKeys.get(index + 1);\r\n  }\r\n\r\n  getVisualDepth(key: KeyType): number {\r\n    let topic = this.getTopic(key);\r\n    let depth = 0;\r\n    while (topic && topic.key !== this.editorRootTopicKey) {\r\n      depth++;\r\n      topic = this.getParentTopic(topic.key);\r\n    }\r\n    return depth;\r\n  }\r\n\r\n  getDepth(key: KeyType) {\r\n    let topic = this.getTopic(key);\r\n    let depth = 0;\r\n    while (topic && topic.key !== this.rootTopicKey) {\r\n      depth++;\r\n      topic = this.getParentTopic(topic.key);\r\n    }\r\n    return depth;\r\n  }\r\n\r\n  get rootTopic() {\r\n    return this.getTopic(this.rootTopicKey);\r\n  }\r\n\r\n  get currentFocusTopic() {\r\n    return this.getTopic(this.focusKey);\r\n  }\r\n\r\n  // 暂时没有用到\r\n  get zoomFactor() {\r\n    return this.get('zoomFactor');\r\n  }\r\n\r\n  isEditorRootKey(topicKey: KeyType) {\r\n    return topicKey === this.editorRootTopicKey;\r\n  }\r\n}\r\n","import { List, Map, Record } from 'immutable';\r\nimport { KeyType } from '../types';\r\nimport { SheetModel } from './sheet-model';\r\n\r\nexport type ExtData = Map<string, any>;\r\n\r\ntype DocRecordType = {\r\n  sheetModels: List<SheetModel>;\r\n  // 用于插件做扩展\r\n  extData: ExtData;\r\n  currentSheetIndex: number;\r\n  formatVersion: string;\r\n};\r\n\r\nconst defaultDocRecord: DocRecordType = {\r\n  sheetModels: List(),\r\n  extData: Map(),\r\n  currentSheetIndex: -1,\r\n  formatVersion: '0.1'\r\n};\r\n\r\nexport class DocModel extends Record(defaultDocRecord) {\r\n  get sheetModels(): List<SheetModel> {\r\n    return this.get('sheetModels');\r\n  }\r\n\r\n  get currentSheetIndex(): number {\r\n    return this.get('currentSheetIndex');\r\n  }\r\n\r\n  get formatVersion(): string {\r\n    return this.get('formatVersion');\r\n  }\r\n\r\n  static createEmpty() {\r\n    return new DocModel({\r\n      sheetModels: List([SheetModel.createEmpty()]),\r\n      currentSheetIndex: 0\r\n    });\r\n  }\r\n\r\n  get currentSheetModel(): SheetModel {\r\n    return this.sheetModels.get(this.currentSheetIndex);\r\n  }\r\n\r\n  get extData(): ExtData {\r\n    return this.get('extData');\r\n  }\r\n\r\n  getSheetModel(sheetId: string): SheetModel {\r\n    return this.sheetModels.find(s => s.id === sheetId);\r\n  }\r\n\r\n  getSheetIndex(sheetModel: SheetModel | KeyType) {\r\n    return sheetModel instanceof SheetModel\r\n      ? this.sheetModels.indexOf(sheetModel)\r\n      : this.sheetModels.findIndex(s => s.id === sheetModel);\r\n  }\r\n\r\n  getExtDataItem<T>(key: string, c: new () => T): T {\r\n    return this.extData.get(key) || new c();\r\n  }\r\n\r\n  getSheetIdThatContainsTopic(topicKey: KeyType) {\r\n    const sheet: SheetModel = this.sheetModels.find(s =>\r\n      s.topics.has(topicKey)\r\n    );\r\n    return sheet ? sheet.id : null;\r\n  }\r\n}\r\n","export function CorePlugin(options: any = {}) {\r\n  const { plugins = [] } = options;\r\n  return [...plugins];\r\n}\r\n","import debug from 'debug';\r\nimport memoizeOne from 'memoize-one';\r\nimport warning from 'tiny-warning';\r\nimport { DocModel, SheetModel } from './models';\r\nimport { CorePlugin } from './plugins/core';\r\nimport { ModelChangeCallback, OnChangeFunction } from './types';\r\n\r\nconst log = debug('core:controller');\r\n\r\nexport interface IControllerOption {\r\n  plugins?: Array<any>;\r\n  docModel?: DocModel;\r\n  readOnly?: boolean;\r\n  onChange?: OnChangeFunction;\r\n}\r\n\r\nexport interface IControllerRunContext {\r\n  controller: Controller;\r\n  docModel?: DocModel;\r\n  model?: SheetModel;\r\n  topicKey?: KeyType;\r\n  getRef?: Function;\r\n}\r\n\r\nexport interface IDiagram {\r\n  getDiagramProps(): IDiagramProps;\r\n  openNewDocModel(newModel: DocModel);\r\n}\r\n\r\nexport interface IDiagramProps {\r\n  docModel: DocModel;\r\n  controller: Controller;\r\n}\r\n\r\nfunction registerPlugin(controller: Controller, plugin: any) {\r\n  if (Array.isArray(plugin)) {\r\n    plugin.forEach(p => registerPlugin(controller, p));\r\n    return;\r\n  }\r\n\r\n  if (plugin == null) {\r\n    return;\r\n  }\r\n\r\n  for (const key in plugin) {\r\n    const fn = plugin[key];\r\n    controller.middleware[key] = controller.middleware[key] || [];\r\n    controller.middleware[key].push(fn);\r\n  }\r\n}\r\n\r\n// modified from koa-compose\r\nfunction compose(middleware) {\r\n  if (!Array.isArray(middleware))\r\n    throw new TypeError('Middleware stack must be an array!');\r\n  for (const fn of middleware) {\r\n    if (typeof fn !== 'function')\r\n      throw new TypeError('Middleware must be composed of functions!');\r\n  }\r\n\r\n  return function(context, next) {\r\n    // last called middleware #\r\n    let index = -1;\r\n    return dispatch(0);\r\n    function dispatch(i) {\r\n      if (i <= index) throw new Error('next() called multiple times');\r\n      index = i;\r\n      let fn = middleware[i];\r\n      if (i === middleware.length) fn = next;\r\n      if (!fn) return null;\r\n      try {\r\n        return fn(context, dispatch.bind(null, i + 1));\r\n      } catch (err) {\r\n        throw err;\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nexport class Controller {\r\n  middleware: Map<string, Function[]>;\r\n  private readonly onChange: OnChangeFunction;\r\n  public readOnly: boolean;\r\n  public docModel: DocModel;\r\n\r\n  get model() {\r\n    return this.docModel.currentSheetModel;\r\n  }\r\n\r\n  constructor(options: IControllerOption = {}) {\r\n    const { plugins = [], onChange, readOnly } = options;\r\n    this.readOnly = readOnly;\r\n    this.onChange = onChange;\r\n    this.middleware = new Map();\r\n    const corePlugin = CorePlugin({ plugins });\r\n    registerPlugin(this, corePlugin);\r\n  }\r\n\r\n  run(key: string, arg?) {\r\n    try {\r\n      const { middleware } = this;\r\n      const fns = middleware[key] || [];\r\n      warning(fns.length !== 0, `the middleware function ${key} is not found!`);\r\n      const composedFn = memoizeOne(compose)(fns);\r\n      // @ts-ignore\r\n      return composedFn(arg);\r\n    } catch (e) {\r\n      this.run('captureError', { error: e });\r\n    }\r\n  }\r\n\r\n  getValue(propKey: string, arg?) {\r\n    return this.run('getValue', { ...arg, propKey });\r\n  }\r\n\r\n  change(model: DocModel, callback?: ModelChangeCallback) {\r\n    log('change', model, model.currentSheetModel);\r\n    this.docModel = model;\r\n    this.onChange(model, callback);\r\n  }\r\n}\r\n"],"names":["log","Map"],"mappings":";;;;;;;MAMa,cAAc,GAAG;IAC5B,IAAI,EAAE,GAAG;IACT,KAAK,EAAE,GAAG;IACV,MAAM,EAAE,GAAG;IACX,IAAI,EAAE,GAAG;EACT;IAEU;AAAZ,WAAY,iBAAiB;IAC3B,2EAAa,CAAA;IACb,2EAAa,CAAA;IACb,6EAAc,CAAA;IACd,2EAAa,CAAA;AACf,CAAC,EALW,iBAAiB,KAAjB,iBAAiB,QAK5B;MAEY,eAAe,GAAG,UAAU;MAE5B,gBAAgB,GAAG;IAC9B,IAAI,EAAE,CAAC;IACP,OAAO,EAAE,CAAC;IACV,MAAM,EAAE,CAAC;EACT;MAEW,SAAS,GAAG;IACvB,OAAO,EAAE,SAAS;IAClB,IAAI,EAAE,MAAM;EACZ;MAEW,SAAS,GAAG;IACvB,MAAM,EAAE,QAAQ;IAChB,eAAe,EAAE,iBAAiB;IAClC,YAAY,EAAE,cAAc;IAC5B,UAAU,EAAE,YAAY;IACxB,QAAQ,EAAE,UAAU;EACpB;MASW,iBAAiB,GAAG;IAC/B,QAAQ,EAAE,UAAU;IACpB,UAAU,EAAE,YAAY;IACxB,OAAO,EAAE,SAAS;IAClB,IAAI,EAAE,MAAM;EACZ;MAEW,MAAM,GAAG;IACpB,SAAS,EAAE,WAAW;IACtB,iBAAiB,EAAE,mBAAmB;IACtC,YAAY,EAAE,cAAc;IAC5B,eAAe,EAAE,iBAAiB;IAClC,eAAe,EAAE,iBAAiB;IAGlC,gBAAgB,EAAE,kBAAkB;IACpC,iBAAiB,EAAE,mBAAmB;IACtC,eAAe,EAAE,iBAAiB;IAClC,4BAA4B,EAAE,8BAA8B;IAE5D,eAAe,EAAE,iBAAiB;IAClC,YAAY,EAAE,cAAc;IAC5B,UAAU,EAAE,YAAY;IACxB,SAAS,EAAE,WAAW;IACtB,SAAS,EAAE,WAAW;IACtB,WAAW,EAAE,aAAa;IAC1B,2BAA2B,EAAE,6BAA6B;IAC1D,MAAM,EAAE,QAAQ;IAChB,OAAO,EAAE,SAAS;IAClB,YAAY,EAAE,cAAc;IAC5B,WAAW,EAAE,aAAa;IAC1B,cAAc,EAAE,gBAAgB;IAChC,SAAS,EAAE,WAAW;IACtB,sBAAsB,EAAE,wBAAwB;IAChD,UAAU,EAAE,YAAY;IACxB,SAAS,EAAE,WAAW;IACtB,eAAe,EAAE,iBAAiB;IAClC,kBAAkB,EAAE,oBAAoB;;IAExC,uBAAuB,EAAE,yBAAyB;;;;;IAKlD,qBAAqB,EAAE,uBAAuB;IAC9C,kBAAkB,EAAE,oBAAoB;IACxC,aAAa,EAAE,eAAe;IAC9B,eAAe,EAAE,iBAAiB;IAClC,cAAc,EAAE,gBAAgB;IAChC,OAAO,EAAE,SAAS;IAClB,SAAS,EAAE,WAAW;;;ACzFxB,MAAM,kBAAkB,GAAoB;IAC1C,IAAI,EAAE,IAAI;IACV,GAAG,EAAE,IAAI;IACT,IAAI,EAAE,IAAI;CACX,CAAC;AAEF,MAAa,KAAM,SAAQ,MAAM,CAAC,kBAAkB,CAAC;IACnD,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACzB;IAED,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACzB;IAED,OAAO,MAAM,CAAC,GAAoB;QAChC,OAAO,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;KACvB;IAED,OAAO,UAAU,CAAC,GAAQ;QACxB,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;;YAE1C,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;SACpC;QACD,MAAM,IAAI,KAAK,CACb,mEAAmE,GAAG,EAAE,CACzE,CAAC;KACH;CACF;;SCSe,WAAW,CAAC,GAAQ;IAClC,QACE,GAAG,CAAC,IAAI,IAAI,IAAI,IAAI,GAAG,CAAC,UAAU,IAAI,IAAI,IAAI,GAAG,CAAC,cAAc,IAAI,IAAI,EACxE;AACJ,CAAC;;MChDY,YAAY,GAAc;IACrC,IAAI,EAAE,cAAc;IACpB,WAAW,EAAE,KAAK;IAClB,UAAU,EAAE,SAAS;IACrB,cAAc,EAAE,SAAS;IACzB,OAAO,EAAE,EAAE;IACX,OAAO,EAAE,CAAC;IACV,YAAY,EAAE;QACZ,UAAU,EAAE,GAAG;KAChB;IAED,SAAS,EAAE;QACT,UAAU,EAAE,CAAC;QACb,SAAS,EAAE,KAAK;QAChB,SAAS,EAAE,SAAS;QACpB,QAAQ,EAAE,OAAO;KAClB;IAED,SAAS,EAAE;QACT,YAAY,EAAE;YACZ,UAAU,EAAE,SAAS;YACrB,KAAK,EAAE,MAAM;YACb,QAAQ,EAAE,MAAM;YAChB,YAAY,EAAE,KAAK;YACnB,OAAO,EAAE,qBAAqB;SAC/B;QACD,YAAY,EAAE;YACZ,QAAQ,EAAE,OAAO;SAClB;KACF;IACD,YAAY,EAAE;QACZ,YAAY,EAAE;YACZ,UAAU,EAAE,MAAM;YAClB,YAAY,EAAE,KAAK;YACnB,KAAK,EAAE,MAAM;YACb,QAAQ,EAAE,MAAM;YAChB,OAAO,EAAE,mBAAmB;SAC7B;QAED,YAAY,EAAE;YACZ,YAAY,EAAE,IAAI;YAClB,QAAQ,EAAE,OAAO;SAClB;KACF;IAED,WAAW,EAAE;QACX,YAAY,EAAE;YACZ,YAAY,EAAE,KAAK;YACnB,UAAU,EAAE,OAAO;YACnB,KAAK,EAAE,SAAS;YAChB,QAAQ,EAAE,MAAM;YAChB,OAAO,EAAE,KAAK;SACf;QAED,YAAY,EAAE;YACZ,YAAY,EAAE,IAAI;YAClB,QAAQ,EAAE,OAAO;SAClB;KACF;CACF;;ACjDD,MAAM,mBAAmB,GAAqB;IAC5C,QAAQ,EAAE,eAAe;IACzB,QAAQ,EAAE,KAAK;IACf,SAAS,EAAE,IAAI;IACf,SAAS,EAAE,iBAAiB,CAAC,aAAa;IAC1C,KAAK,EAAE,YAAY;CACpB,CAAC;AAEF,MAAa,MAAO,SAAQ,MAAM,CAAC,mBAAmB,CAAC;IACrD,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;KAC7B;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAC9B;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;KAC7B;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAC9B;IAED,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KAC1B;IAED,OAAO,QAAQ,CAAC,GAAG;QACjB,OAAO,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;KACxB;CACF;;ACpBD,MAAM,kBAAkB,GAAoB;IAC1C,GAAG,EAAE,IAAI;IACT,SAAS,EAAE,IAAI;IACf,QAAQ,EAAE,KAAK;IACf,OAAO,EAAE,IAAI;IACb,MAAM,EAAE,IAAI;IACZ,SAAS,EAAE,IAAI;IACf,KAAK,EAAE,IAAI;CACZ,CAAC;AAEF,MAAa,KAAM,SAAQ,MAAM,CAAC,kBAAkB,CAAC;IACnD,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;KACxB;IACD,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAC9B;IACD,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;KAC7B;IACD,IAAI,OAAO;QACT,OAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;KAC5B;IACD,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KAC3B;IACD,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAC9B;IACD,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KAC1B;IAED,QAAQ,CAAC,IAAY;QACnB,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC;QAC1D,IAAI,KAAK,KAAK,CAAC,CAAC;YAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;QAChD,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;KACjD;IAED,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC;KACpD;IAED,OAAO,QAAQ,CAAC,GAAG;QACjB,MAAM,EACJ,GAAG,EACH,SAAS,GAAG,IAAI,EAChB,MAAM,EACN,OAAO,GAAG,EAAE,EACZ,QAAQ,GAAG,KAAK,EACjB,GAAG,GAAG,CAAC;QACR,OAAO,IAAI,KAAK,CAAC;YACf,GAAG;YACH,SAAS;YACT,QAAQ;YACR,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC;YACtB,MAAM,EAAE,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC;SACjC,CAAC,CAAC;KACJ;IAED,OAAO,MAAM,CAAC,EACZ,GAAG,EACH,SAAS,GAAG,IAAI,EAChB,OAAO,GAAG,EAAE,EACZ,OAAO,GAAG,EAAE,EACZ,QAAQ,GAAG,KAAK,EACD;QACf,MAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC;YACzB,IAAI,EAAE,SAAS,CAAC,OAAO;YACvB,IAAI,EAAE,OAAO;YACb,GAAG,EAAE,IAAI;SACV,CAAC,CAAC;QACH,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;QAC7B,OAAO,IAAI,KAAK,CAAC;YACf,GAAG;YACH,SAAS;YACT,MAAM;YACN,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC;YACtB,QAAQ;SACT,CAAC,CAAC;KACJ;CACF;;ACjGD,MAAM,0BAA0B,GAA4B;IAC1D,IAAI,EAAE,IAAI;IACV,IAAI,EAAE,IAAI;IACV,QAAQ,EAAE,KAAK;CAChB,CAAC;AAEF,MAAa,aAAc,SAAQ,MAAM,CAAC,0BAA0B,CAAC;IACnE,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACzB;IAED,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;KACzB;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;KAC7B;CACF;;SCvBe,kBAAkB,CAChC,KAAiB,EACjB,QAAiB;IAEjB,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAEtC,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,CAAC,EAAE;QACzB,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QACvC,GAAG,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,CAAC;QACrB,GAAG,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG;YAC5B,GAAG,CAAC,IAAI,CAAC,GAAG,kBAAkB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;YAC5C,OAAO,GAAG,CAAC;SACZ,EAAE,GAAG,CAAC,CAAC;KACT;IACD,OAAO,GAAG,CAAC;AACb,CAAC;AAED,SAAgB,UAAU,CACxB,KAAiB,EACjB,QAAiB,EACjB,UAAmB,KAAK;IAExB,MAAM,GAAG,GAAG,CAAC,QAAQ,CAAC,CAAC;IACvB,IAAI,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACpC,OAAO,IAAI,CAAC,SAAS,EAAE;QACrB,OAAO,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACjE,IAAI,GAAG,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACvC;IACD,OAAO,GAAG,CAAC;AACb,CAAC;AAED,SAAgB,eAAe,CAC7B,KAAiB,EACjB,MAAe,EACf,MAAe;IAEf,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IACxC,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IACxC,IAAI,QAAQ,IAAI,QAAQ,EAAE;QACxB,IAAI,QAAQ,CAAC,SAAS,IAAI,QAAQ,CAAC,SAAS;YAC1C,OAAO,iBAAiB,CAAC,OAAO,CAAC;QACnC,IAAI,MAAM,GAAG,QAAQ,CAAC;QACtB,OAAO,MAAM,CAAC,SAAS,EAAE;YACvB,IAAI,MAAM,CAAC,SAAS,KAAK,QAAQ,CAAC,GAAG;gBACnC,OAAO,iBAAiB,CAAC,UAAU,CAAC;YACtC,MAAM,GAAG,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC3C;QACD,MAAM,GAAG,QAAQ,CAAC;QAClB,OAAO,MAAM,CAAC,SAAS,EAAE;YACvB,IAAI,MAAM,CAAC,SAAS,KAAK,QAAQ,CAAC,GAAG;gBAAE,OAAO,iBAAiB,CAAC,QAAQ,CAAC;YACzE,MAAM,GAAG,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC3C;KACF;IACD,OAAO,iBAAiB,CAAC,IAAI,CAAC;AAChC,CAAC;AAED,SAAgB,eAAe,CAAC,KAAiB,EAAE,QAAiB;IAClE,MAAM,WAAW,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IACnD,IAAI,WAAW,EAAE;QACf,MAAM,KAAK,GAAG,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACpD,IAAI,KAAK,KAAK,CAAC,EAAE;YACf,OAAO,WAAW,CAAC,GAAG,CAAC;SACxB;QACD,OAAO,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;KAC3C;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED,SAAgB,eAAe,CAAC,KAAiB,EAAE,QAAiB,KAAI;AAExE;AACA,SAAgB,YAAY,CAAC,KAAiB,EAAE,QAAiB;IAC/D,MAAM,WAAW,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IACnD,IAAI,WAAW,EAAE;QACf,MAAM,KAAK,GAAG,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACpD,IAAI,KAAK,KAAK,CAAC,EAAE;YACf,OAAO,IAAI,CAAC;SACb;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAgB,SAAS,CACvB,KAAiB,EACjB,IAAa,EACb,IAAa;IAEb,OAAO,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;AACnE,CAAC;AAED;;;;;;AAMA,SAAgB,qBAAqB,CACnC,KAAiB,EACjB,GAAY,EACZ,KAAa;IAEb,IAAI,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IACnC,IAAI,QAAQ,KAAK,KAAK;QAAE,OAAO,GAAG,CAAC;IACnC,IAAI,QAAQ,GAAG,KAAK;QAAE,OAAO,IAAI,CAAC;IAClC,OAAO,QAAQ,GAAG,KAAK,EAAE;QACvB,GAAG,GAAG,KAAK,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QAC9B,QAAQ,EAAE,CAAC;KACZ;IACD,OAAO,GAAG,CAAC;AACb,CAAC;AAED;;;;;;AAMA,SAAgB,sBAAsB,CACpC,KAAiB,EACjB,IAAa,EACb,IAAa;IAEb,MAAM,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAChC,MAAM,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAChC,IAAI,EAAE,KAAK,EAAE,EAAE;QACb,IAAI,SAAS,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC;YAAE,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACtD,OAAO,sBAAsB,CAC3B,KAAK,EACL,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,EACxB,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,CACzB,CAAC;KACH;IACD,OAAO,EAAE,GAAG,EAAE;UACV,sBAAsB,CACpB,KAAK,EACL,qBAAqB,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE,CAAC,EACtC,IAAI,CACL;UACD,sBAAsB,CACpB,KAAK,EACL,IAAI,EACJ,qBAAqB,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE,CAAC,CACvC,CAAC;AACR,CAAC;AAED;;;;;;AAMA,SAAgB,eAAe,CAC7B,KAAiB,EACjB,OAAgB,EAChB,OAAgB;IAEhB,MAAM,KAAK,GAAG,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;IAC5C,MAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;IAC9B,MAAM,EAAE,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IACpC,MAAM,EAAE,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IACpC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC;QAClB,MAAM,IAAI,KAAK,CACb,yBAAyB,OAAO,gBAAgB,OAAO,cAAc,CACtE,CAAC;IACJ,OAAO,CAAC,EAAE,GAAG,EAAE;UACX,OAAO,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC;UACzB,OAAO,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,EAC3B,OAAO,EAAE,CAAC;AACd,CAAC;AAED;;;;;AAKA,SAAgB,sBAAsB,CACpC,KAAiB,EACjB,GAAY;IAEZ,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IAClC,OAAO,KAAK,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC;UAC3B,GAAG;;YAEH,sBAAsB,CAAC,KAAK,EAAE,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AAC1D,CAAC;AAED;;;;;AAKA,SAAgB,4BAA4B,CAC1C,KAAiB,EACjB,GAAY;IAEZ,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IAClC,OAAO,KAAK,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,QAAQ;UAC7C,GAAG;;YAEH,4BAA4B,CAAC,KAAK,EAAE,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AAChE,CAAC;AAED;;;;;AAKA,SAAgB,aAAa,CAAC,KAAiB,EAAE,IAAoB;IACnE,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;QAC3B,MAAM,SAAS,GAAG,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAC9C,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;YACtB,IAAI,KAAK,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,SAAS;gBAAE,OAAO,KAAK,CAAC;SACzD;QACD,OAAO,IAAI,CAAC;KACb;IACD,OAAO,KAAK,CAAC;AACf,CAAC;;SC5Ne,SAAS;IACvB,OAAO,sCAAsC,CAAC,OAAO,CAAC,OAAO,EAAE,UAAS,CAAC;QACvE,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,IAAI,CAAC,EAChC,CAAC,GAAG,CAAC,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,IAAI,GAAG,CAAC;QACtC,OAAO,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;KACvB,CAAC,CAAC;AACL,CAAC;;ACkBD,MAAM,GAAG,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC;AA2D9B,SAAS,cAAc,CAAC,EACtB,KAAK,EACL,QAAQ,EACkB;IAC1B,IAAI,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrC,IAAI,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC,EAAE;QACrC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;YAClB,QAAQ,EAAE,CAAC,KAAK,CAAC,QAAQ;SAC1B,CAAC,CAAC;QACH,KAAK,GAAG,KAAK,CAAC,QAAQ,CACpB,CAAC,QAAQ,EAAE,KAAK,CAAC,GAAG,EAAE,UAAU,CAAC,EACjC,QAAQ,IAAI,CAAC,QAAQ,CACtB,CAAC;KACH;IACD,KAAK,GAAG,UAAU,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAE,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC;IACrE,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,WAAW,CAAC,EACnB,KAAK,EACqB;IAC1B,MAAM,SAAS,GAAG,kBAAkB,CAAC,KAAK,EAAE,KAAK,CAAC,kBAAkB,CAAC,CAAC;IACtE,GAAG,CAAC,KAAK,CAAC,CAAC;IACX,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;QAC3B,SAAS,CAAC,OAAO,CAAC,QAAQ;YACxB,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC,EAAE,IAAI,CAAC,CAAC;SACjD,CAAC,CAAC;KACJ,CAAC,CAAC;IACH,KAAK,GAAG,UAAU,CAAC;QACjB,KAAK;QACL,QAAQ,EAAE,KAAK,CAAC,kBAAkB;QAClC,SAAS,EAAE,SAAS,CAAC,MAAM;KAC5B,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,SAAS,CAAC,EACjB,KAAK,EACqB;IAC1B,MAAM,SAAS,GAAG,kBAAkB,CAAC,KAAK,EAAE,KAAK,CAAC,kBAAkB,CAAC,CAAC;IACtE,GAAG,CAAC,KAAK,CAAC,CAAC;IACX,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;QAC3B,SAAS,CAAC,OAAO,CAAC,QAAQ;YACxB,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC,EAAE,KAAK,CAAC,CAAC;SAClD,CAAC,CAAC;KACJ,CAAC,CAAC;IACH,GAAG,CAAC,KAAK,CAAC,CAAC;IACX,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,QAAQ,CAAC,EAChB,KAAK,EACL,QAAQ,EACkB;IAC1B,MAAM,IAAI,GAAG,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,QAAQ,CAAC,CAAC;IACrE,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;QAC3B,IAAI,CAAC,OAAO,CAAC,QAAQ;YACnB,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC,EAAE,KAAK,CAAC,CAAC;SAClD,CAAC,CAAC;KACJ,CAAC,CAAC;;IAEH,IACE,eAAe,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,CAAC,kBAAkB,CAAC;QAC1D,iBAAiB,CAAC,UAAU,EAC5B;QACA,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,oBAAoB,EAAE,KAAK,CAAC,YAAY,CAAC,CAAC;KAC7D;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,UAAU,CAAC,EAClB,KAAK,EACL,QAAQ,EACR,SAAS,GAAG,SAAS,CAAC,MAAM,EACZ;IAChB,GAAG,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;IAC9B,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;QAC/B,MAAM,IAAI,KAAK,CAAC,aAAa,QAAQ,kBAAkB,CAAC,CAAC;KAC1D;IACD,IAAI,QAAQ,KAAK,KAAK,CAAC,QAAQ;QAAE,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;;IAEzE,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAC1C,IAAI,KAAK,CAAC,YAAY,IAAI,IAAI;QAAE,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;IACxE,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,YAAY,CAAC,EACpB,KAAK,EACL,SAAS,EACO;IAChB,GAAG,CAAC,cAAc,CAAC,CAAC;;IAEpB,IAAI,SAAS,KAAK,KAAK,CAAC,SAAS,IAAI,SAAS,KAAK,SAAS,CAAC,UAAU;QACrE,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAC5C,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,QAAQ,CAAC,EAChB,KAAK,EACL,QAAQ,EACR,UAAU,GAAG,KAAK,EAGnB;IACC,GAAG,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;IAC3B,IAAI,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrC,IAAI,KAAK,EAAE;QACT,MAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,SAAS,EAAE,EAAE,SAAS,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC;QACvE,KAAK,GAAG,KAAK;aACV,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC;aACtB,MAAM,CAAC,SAAS,EAAE,OAAO,IACxB,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAClE,CAAC;QACJ,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,IACnC,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAClD,CAAC;QACF,OAAO,UAAU,CAAC;YAChB,KAAK;YACL,QAAQ,EAAE,KAAK,CAAC,GAAG;YACnB,SAAS,EAAE,SAAS,CAAC,eAAe;SACrC,CAAC,CAAC;KACJ;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,UAAU,CAAC,EAClB,KAAK,EACL,QAAQ,EACR,OAAO,EAGR;IACC,IAAI,QAAQ,KAAK,KAAK,CAAC,YAAY;QAAE,OAAO,KAAK,CAAC;IAClD,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,IAAI,KAAK,EAAE;QACT,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAC9C,MAAM,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAC5C,MAAM,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC;YAC3B,GAAG,EAAE,SAAS,EAAE;YAChB,SAAS,EAAE,KAAK,CAAC,GAAG;YACpB,OAAO;SACR,CAAC,CAAC;QACH,KAAK,GAAG,KAAK;aACV,MAAM,CAAC,QAAQ,EAAE,MAAM,IAAI,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;aAC5D,QAAQ,CAAC,CAAC,QAAQ,EAAE,KAAK,CAAC,GAAG,EAAE,SAAS,CAAC,EAAE,OAAO,IACjD,OAAO,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,CAAC,GAAG,CAAC,CACrC,CAAC;QACJ,OAAO,UAAU,CAAC;YAChB,KAAK;YACL,QAAQ,EAAE,OAAO,CAAC,GAAG;YACrB,SAAS,EAAE,SAAS,CAAC,eAAe;SACrC,CAAC,CAAC;KACJ;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,uBAAuB,CAAC,EAC/B,KAAK,EACL,QAAQ,EACkB;IAC1B,MAAM,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,KAAK;SACvE,IAAI,CAAC;IACR,MAAM,IAAI,GAAG,UAAU,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC,CAAC;IACxE,OAAO,wBAAwB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC;AAC7D,CAAC;AAED,SAAS,WAAW,CAAC,EACnB,KAAK,EACL,QAAQ,EACkB;IAC1B,IAAI,QAAQ,KAAK,KAAK,CAAC,kBAAkB;QAAE,OAAO,KAAK,CAAC;IACxD,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACtC,IAAI,IAAI,EAAE;QACR,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;YAC3B,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM;gBACvB,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;gBACjC,MAAM,UAAU,GAAG,kBAAkB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;gBACvD,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC,CAAC;oBAC7B,UAAU,CAAC,OAAO,CAAC,IAAI;wBACrB,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;qBAChB,CAAC,CAAC;iBACJ,CAAC,CAAC;gBACH,OAAO,MAAM,CAAC;aACf,CAAC,CAAC;YACH,CAAC,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,EAAE,OAAO,IACvD,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAC1C,CAAC;YACF,IAAI,CAAC,CAAC,QAAQ,KAAK,QAAQ;gBACzB,CAAC,CAAC,GAAG,CAAC,UAAU,EAAE,eAAe,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,GAAG,CACrD,WAAW,EACX,SAAS,CAAC,eAAe,CAC1B,CAAC;SACL,CAAC,CAAC;KACJ;IAED,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,YAAY,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE;IACxC,IAAI,SAAS,IAAI,IAAI;QAAE,SAAS,GAAG,KAAK,CAAC,mBAAmB,CAAC;IAC7D,SAAS,CAAC,OAAO,CAAC,QAAQ;QACxB,KAAK,GAAG,WAAW,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;KAC1C,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC;AAED;;;;;;;;AAQA,SAAS,iBAAiB,CAAC,EACzB,KAAK,EACL,QAAQ,EACR,SAAS,EACT,SAAS,EACT,IAAI,EACiB;IACrB,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,IAAI,KAAK,EAAE;QACT,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QACnD,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YAChB,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,EAAE,MAAM,IAC3D,MAAM,CAAC,IAAI,CACT,KAAK,CAAC,MAAM,CAAC;gBACX,IAAI,EAAE,SAAS;gBACf,IAAI,EAAE,IAAI;aACX,CAAC,CACH,CACF,CAAC;SACH;aAAM;YACL,IAAI,KAAK,CAAC,IAAI,KAAK,IAAI,EAAE;gBACvB,KAAK,GAAG,KAAK,CAAC,QAAQ,CACpB,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,CAAC,EAC7C,EAAE,IAAI,IAAI,CACX,CAAC;aACH;SACF;QACD,IAAI,SAAS,EAAE;YACb,KAAK,GAAG,UAAU,CAAC;gBACjB,KAAK;gBACL,QAAQ;gBACR,SAAS;aACV,CAAC,CAAC;SACJ;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,wBAAwB,CAAC,EAChC,KAAK,EACL,QAAQ,EACR,SAAS,GAAG,IAAI,EAChB,IAAI,EACL;IACC,OAAO,iBAAiB,CAAC;QACvB,KAAK;QACL,QAAQ;QACR,SAAS;QACT,IAAI;QACJ,SAAS,EAAE,SAAS,CAAC,OAAO;KAC7B,CAAC,CAAC;AACL,CAAC;AAED,SAAS,gBAAgB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAuB;IAC3E,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,IAAI,KAAK,EAAE;QACT,MAAM,EAAE,KAAK,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QAC5C,IAAI,KAAK,KAAK,CAAC,CAAC,EAAE;YAChB,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,QAAQ,CAAC,EAAE,MAAM,IAC3D,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CACrB,CAAC;SACH;QACD,KAAK,GAAG,YAAY,CAAC;YACnB,KAAK;YACL,SAAS,EAAE,SAAS,CAAC,MAAM;SAC5B,CAAC,CAAC;KACJ;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,AAIA,SAAS,QAAQ,CAAC,EAChB,KAAK,EACL,QAAQ,EACR,KAAK,EACY;IACjB,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,IAAI,KAAK,EAAE;QACT,IAAI,KAAK,KAAK,KAAK,CAAC,KAAK,EAAE;YACzB,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,OAAO,CAAC,EAAE,CAAC,IAAI,KAAK,CAAC,CAAC;SACnE;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,mBAAmB,CAAC,EAC3B,KAAK,EACqB;IAC1B,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,KAAK;QAC/B,KAAK,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,GAAG;YAC/B,KAAK,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,GAAG,EAAE,OAAO,CAAC,EAAE,IAAI,CAAC,CAAC;SAC7C,CAAC,CAAC;KACJ,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,QAAQ,CAAC,EAAE,KAAK,EAAE,KAAK,EAAe;IAC7C,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,KAAK,CAAC,CAAC;IAChD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,YAAY,CAAC,EACpB,KAAK,EACL,SAAS,EACO;IAChB,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,KAAK,SAAS;QAAE,OAAO,KAAK,CAAC;IACvD,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,SAAS,CAAC,CAAC;IACxD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,SAAS,CAAC,EAAE,KAAK,EAAE,MAAM,EAAgB;IAChD,OAAO,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;AACzD,CAAC;AAED,SAAS,qBAAqB,CAAC,EAC7B,KAAK,EACL,QAAQ,EACkB;IAC1B,IAAI,KAAK,CAAC,kBAAkB,KAAK,QAAQ;QACvC,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,oBAAoB,EAAE,QAAQ,CAAC,CAAC;IACpD,IAAI,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,QAAQ;QACnC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC,EAAE,KAAK,CAAC,CAAC;IAC/D,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,aAAa,CAAC,EACrB,KAAK,EACL,UAAU,EACO;IACjB,IAAI,KAAK,CAAC,UAAU,KAAK,UAAU;QACjC,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;IAC9C,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,mBAAmB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAA6B;IACzE,OAAO,UAAU,CAAC;QAChB,KAAK;QACL,QAAQ;QACR,SAAS,EAAE,SAAS,CAAC,eAAe;KACrC,CAAC,CAAC;AACL,CAAC;AACD,SAAS,gBAAgB,CAAC,EAAE,KAAK,EAAE,QAAQ,EAA6B;IACtE,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAC5C,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,IAAI,EAAE;QACjD,KAAK,GAAG,kBAAkB,CAAC,iBAAiB,CAAC;YAC3C,KAAK;YACL,QAAQ;YACR,SAAS,EAAE,SAAS,CAAC,IAAI;YACzB,IAAI,EAAE,IAAI,aAAa,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;SACrE,CAAC,CAAC;KACJ;IACD,KAAK,GAAG,kBAAkB,CAAC,UAAU,CAAC;QACpC,KAAK;QACL,QAAQ;QACR,SAAS,EAAE,SAAS,CAAC,YAAY;KAClC,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,WAAW,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE;IACrD,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IACxC,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAExC,MAAM,YAAY,GAAG,QAAQ,CAAC,SAAS,CAAC;IACxC,MAAM,cAAc,GAAG,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;IACpD,IAAI,gBAAgB,GAAG,cAAc,CAAC,OAAO,CAAC;IAC9C,MAAM,QAAQ,GAAG,gBAAgB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAElD,gBAAgB,GAAG,gBAAgB,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAErD,IAAI,OAAO,KAAK,IAAI,EAAE;QACpB,IAAI,UAAU,GAAG,QAAQ,CAAC,OAAO,CAAC;QAClC,UAAU,GAAG,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACrC,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;YAC3B,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,YAAY,EAAE,SAAS,CAAC,EAAE,gBAAgB,CAAC;iBAC3D,KAAK,CAAC,CAAC,QAAQ,EAAE,MAAM,EAAE,WAAW,CAAC,EAAE,MAAM,CAAC;iBAC9C,KAAK,CAAC,CAAC,QAAQ,EAAE,MAAM,EAAE,SAAS,CAAC,EAAE,UAAU,CAAC;iBAChD,KAAK,CAAC,CAAC,QAAQ,EAAE,MAAM,EAAE,UAAU,CAAC,EAAE,KAAK,CAAC,CAAC;SACjD,CAAC,CAAC;KACJ;SAAM;QACL,MAAM,YAAY,GAAG,QAAQ,CAAC,SAAS,CAAC;QACxC,MAAM,aAAa,GAAG,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QACnD,IAAI,gBAAgB,GAAG,aAAa,CAAC,OAAO,CAAC;QAC7C,MAAM,QAAQ,GAAG,gBAAgB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;;QAElD,IAAI,YAAY,KAAK,YAAY,EAAE;YACjC,IAAI,mBAAmB,GAAG,IAAI,EAAE,CAAC;YACjC,gBAAgB,CAAC,OAAO,CAAC,GAAG;gBAC1B,IAAI,GAAG,KAAK,MAAM,EAAE;oBAClB,IAAI,GAAG,KAAK,MAAM,EAAE;wBAClB,IAAI,OAAO,KAAK,MAAM,EAAE;4BACtB,mBAAmB,GAAG,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;yBAClE;6BAAM;4BACL,mBAAmB,GAAG,mBAAmB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;yBAClE;qBACF;yBAAM;wBACL,mBAAmB,GAAG,mBAAmB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBACrD;iBACF;aACF,CAAC,CAAC;YACH,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;gBAC3B,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,YAAY,EAAE,SAAS,CAAC,EAAE,mBAAmB,CAAC,CAAC;aACnE,CAAC,CAAC;SACJ;aAAM;YACL,IAAI,OAAO,KAAK,MAAM,EAAE;gBACtB,gBAAgB,GAAG,gBAAgB,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;aAC9D;iBAAM,IAAI,OAAO,KAAK,MAAM,EAAE;gBAC7B,gBAAgB,GAAG,gBAAgB,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,EAAE,MAAM,CAAC,CAAC;aAClE;YACD,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;gBAC3B,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,YAAY,EAAE,SAAS,CAAC,EAAE,gBAAgB,CAAC;qBAC3D,KAAK,CAAC,CAAC,QAAQ,EAAE,MAAM,EAAE,WAAW,CAAC,EAAE,YAAY,CAAC;qBACpD,KAAK,CAAC,CAAC,QAAQ,EAAE,YAAY,EAAE,SAAS,CAAC,EAAE,gBAAgB,CAAC;qBAC5D,KAAK,CAAC,CAAC,QAAQ,EAAE,YAAY,EAAE,UAAU,CAAC,EAAE,KAAK,CAAC,CAAC;aACvD,CAAC,CAAC;SACJ;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,MAAM,CAAC,EACd,KAAK,EACL,SAAS,EACiB;IAC1B,IAAI,SAAS,IAAI,IAAI;QAAE,SAAS,GAAG,KAAK,CAAC,mBAAmB,CAAC;IAC7D,MAAM,QAAQ,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;IAC9B,MAAM,MAAM,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IAC9C,MAAM,QAAQ,GAAG,EAAE,CAAC;IAEpB,KAAK,MAAM,OAAO,IAAI,SAAS,EAAE;QAC/B,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;;QAE5C,IAAI,GAAG,KAAK,CAAC,CAAC;YAAE,OAAO,KAAK,CAAC;QAC7B,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACpB;;IAED,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;IAE/B,MAAM,QAAQ,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IAC7B,IAAI,QAAQ,KAAK,CAAC,EAAE;QAClB,OAAO,KAAK,CAAC;KACd;SAAM;QACL,MAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QACpE,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,MAAM,CAAC,GAAG,EAAE,SAAS,CAAC,EAAE,OAAO,IAC/D,OAAO;aACJ,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC;aACpC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,cAAc,CAAC,CACjD,CAAC;KACH;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,QAAQ,CAAC,EAChB,KAAK,EACL,SAAS,EACiB;IAC1B,IAAI,SAAS,IAAI,IAAI;QAAE,SAAS,GAAG,KAAK,CAAC,mBAAmB,CAAC;IAC7D,MAAM,QAAQ,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;IAC9B,MAAM,MAAM,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IAC9C,MAAM,QAAQ,GAAG,EAAE,CAAC;IAEpB,KAAK,MAAM,OAAO,IAAI,SAAS,EAAE;QAC/B,MAAM,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC5C,IAAI,GAAG,KAAK,CAAC,CAAC;YAAE,OAAO,KAAK,CAAC;QAC7B,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACpB;IACD,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;IAE/B,MAAM,OAAO,GAAG,QAAQ,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IAC9C,IAAI,OAAO,KAAK,MAAM,CAAC,OAAO,CAAC,IAAI,GAAG,CAAC,EAAE;QACvC,OAAO,KAAK,CAAC;KACd;SAAM;QACL,MAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;QACpE,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,MAAM,CAAC,GAAG,EAAE,SAAS,CAAC,EAAE,OAAO,IAC/D,OAAO;aACJ,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC;aACpC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,cAAc,CAAC,CACjD,CAAC;KACH;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,eAAe,CAAC,EACvB,KAAK,EACL,QAAQ,EACR,YAAY,EACZ,UAAU,EAIX;IACC,MAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACvC,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC;IAClC,MAAM,WAAW,GAAG,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAC9C,MAAM,GAAG,GAAG,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAClD,IAAI,YAAY,EAAE;QAChB,MAAM,QAAQ,GAAG,YAAY,CAAC,GAAG,CAAC,OAAO,IACvC,KAAK,CAAC,MAAM,CAAC;YACX,GAAG,EAAE,SAAS,EAAE;YAChB,SAAS;YACT,OAAO;SACR,CAAC,CACH,CAAC;QACF,MAAM,YAAY,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;QAC9C,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,KAAK;YAC/B,QAAQ,CAAC,OAAO,CAAC,OAAO;gBACtB,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,IAAI,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC;aACpE,CAAC,CAAC;YACH,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,SAAS,EAAE,SAAS,CAAC,EAAE,OAAO,IACtD,OAAO,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,YAAY,CAAC,CAC5C,CAAC;SACH,CAAC,CAAC;QACH,KAAK,GAAG,UAAU,CAAC;YACjB,KAAK;YACL,QAAQ,EAAE,YAAY,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC;YAC/C,SAAS,EAAE,SAAS,CAAC,eAAe;SACrC,CAAC,CAAC;KACJ,AACA;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,aAAa,CAAC,EACrB,KAAK,EACL,QAAQ,EACR,UAAU,GAAG,KAAK,EAClB,YAAY,EACZ,UAAU,EAKX;IACC,IAAI,YAAY,EAAE;QAChB,UAAU,GAAG,YAAY,CAAC,GAAG,CAAC,OAAO,IACnC,KAAK,CAAC,MAAM,CAAC;YACX,GAAG,EAAE,SAAS,EAAE;YAChB,SAAS,EAAE,QAAQ;YACnB,OAAO;SACR,CAAC,CACH,CAAC;KACH;IAED,MAAM,SAAS,GAAG,UAAU;SACzB,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,SAAS,KAAK,QAAQ,CAAC;SACrC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC;IACnB,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,KAAK;QAC/B,UAAU,CAAC,OAAO,CAAC,KAAK;YACtB,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;SAClE,CAAC,CAAC;QACH,KAAK,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS,CAAC,EAAE,OAAO,IACrD,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,SAAS,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC,CACxE,CAAC;KACH,CAAC,CAAC;IACH,KAAK,GAAG,UAAU,CAAC;QACjB,KAAK;QACL,QAAQ,EAAE,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;QACzC,SAAS,EAAE,SAAS,CAAC,eAAe;KACrC,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,cAAc,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE;IACvC,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,KAAK;QAC/B,MAAM,CAAC,OAAO,CAAC,KAAK;YAClB,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;SAClE,CAAC,CAAC;KACJ,CAAC,CAAC;IACH,OAAO,KAAK,CAAC;AACf,CAAC;AAED,MAAa,kBAAkB,GAAG;IAChC,QAAQ;IACR,UAAU;IACV,cAAc;IACd,aAAa;IACb,eAAe;IACf,cAAc;IACd,WAAW;IACX,SAAS;IACT,QAAQ;IACR,UAAU;IACV,uBAAuB;IACvB,YAAY;IACZ,WAAW;IACX,YAAY;IACZ,iBAAiB;IACjB,wBAAwB;IACxB,gBAAgB;IAChB,QAAQ;IACR,mBAAmB;IACnB,SAAS;IACT,QAAQ;IACR,YAAY;IACZ,qBAAqB;IACrB,aAAa;IACb,mBAAmB;IACnB,gBAAgB;IAChB,WAAW;IACX,MAAM;IACN,QAAQ;CACT;;ACvrBD,MAAMA,KAAG,GAAG,KAAK,CAAC,UAAU,CAAC,CAAC;AAY9B,SAAgB,oBAAoB,CAClC,QAAkB,EAClB,UAAsB;IAEtB,IAAI,QAAQ,CAAC,iBAAiB,KAAK,UAAU,EAAE;QAC7C,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAC1B,CAAC,aAAa,EAAE,QAAQ,CAAC,iBAAiB,CAAC,EAC3C,CAAC,IAAI,UAAU,CAChB,CAAC;KACH;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAgB,sBAAsB,CAAC,sBAAsB;IAC3D,OAAO,GAAG;QACR,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,EAAE,GAAG,GAAG,CAAC;QAClC,OAAO,oBAAoB,CACzB,QAAQ,EACR,sBAAsB,CAAC,EAAE,GAAG,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,iBAAiB,EAAE,CAAC,CACvE,CAAC;KACH,CAAC;AACJ,CAAC;AAED,SAAS,QAAQ,CAAC,EAChB,QAAQ,EACR,UAAU,EACc;IACxB,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,aAAa,EAAE,WAAW,IACnD,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAC7B,CAAC;IACF,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,mBAAmB,EAAE,QAAQ,CAAC,WAAW,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC;IAC5E,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,eAAe,CAAC,EACvB,QAAQ,EACR,UAAU,GAAG,IAAI,EACjB,UAAU,GAAG,IAAI,EACjB,OAAO,GAAG,IAAI,EACuD;IACrE,IAAI,UAAU,IAAI,IAAI,IAAI,UAAU,IAAI,IAAI,EAAE;QAC5C,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;KACvD;IACD,IAAI,UAAU,IAAI,IAAI,IAAI,QAAQ,CAAC,iBAAiB,KAAK,UAAU,EAAE;QACnE,IAAI,UAAU,IAAI,CAAC,IAAI,UAAU,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,EAAE;YAC7D,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,mBAAmB,EAAE,UAAU,CAAC,CAAC;SAC1D;KACF;SAAM,IAAI,UAAU,IAAI,IAAI,EAAE;QAC7B,MAAM,GAAG,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QACrD,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE;YACd,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;SAClD;QACD,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;KACnD;SAAM,IAAI,OAAO,EAAE;QAClB,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QAC5C,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE;YACd,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;SAClD;QACD,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;KACnD;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,cAAc,CAAC,EACtB,QAAQ,EACR,UAAU,EACV,KAAK,EACuC;IAC5C,MAAM,GAAG,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IACrD,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE;QACd,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;KAClD;IACD,QAAQ,GAAG,QAAQ;SAChB,MAAM,CAAC,aAAa,EAAE,WAAW,IAChC,WAAW,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,EAAE,UAAU,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAC5D;SACA,GAAG,CAAC,mBAAmB,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC;IACrC,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,WAAW,CAAC,EAAE,QAAQ,EAAE,UAAU,EAA2B;IACpE,MAAM,GAAG,GAAG,QAAQ,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IACrD,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE;QACd,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;KAClD;IACD,QAAQ,GAAG,QAAQ;SAChB,MAAM,CAAC,aAAa,EAAE,WAAW,IAAI,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC7D,GAAG,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;IAC/B,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,aAAa,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE;IACxC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAC1B,CAAC,aAAa,EAAE,QAAQ,CAAC,iBAAiB,CAAC,EAC3C,UAAU,IAAI,UAAU,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAC7C,CAAC;IACF,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,wBAAwB,CAAC,EAChC,QAAQ,EACR,QAAQ,EACR,UAAU,GAAG,KAAK,EAClB,YAAY,EACZ,UAAU,EACV,OAAO,EACR;IACC,QAAQ,GAAG,oBAAoB,CAC7B,QAAQ,EACR,kBAAkB,CAAC,aAAa,CAAC;QAC/B,KAAK,EAAE,QAAQ,CAAC,iBAAiB;QACjC,QAAQ;QACR,UAAU;QACV,YAAY;QACZ,UAAU;KACX,CAAC,CACH,CAAC;IACF,IAAI,OAAO;QAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;IACzD,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,MAAM,gBAAgB,GAAQ;IAC5B,QAAQ;IACR,eAAe;IACf,cAAc;IACd,WAAW;IACX,aAAa;IACb,wBAAwB;CACzB,CAAC;AAEF,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,OAAO,CAAC,CAAC;IACvC,gBAAgB,CAAC,CAAC,CAAC,GAAG,sBAAsB,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAAC;AACtE,CAAC,CAAC,CAAC;;AClIH,MAAM,kBAAkB,GAAoB;IAC1C,EAAE,EAAE,IAAI;IACR,KAAK,EAAE,IAAI;IACX,MAAM,EAAEC,KAAG,EAAE;IACb,MAAM,EAAE,IAAI,MAAM,EAAE;IACpB,YAAY,EAAE,IAAI;IAClB,kBAAkB,EAAE,IAAI;IACxB,QAAQ,EAAE,IAAI;IACd,SAAS,EAAE,IAAI;IACf,UAAU,EAAE,CAAC;IACb,YAAY,EAAE,IAAI;IAClB,aAAa,EAAE,IAAI;CACpB,CAAC;AAEF,MAAa,UAAW,SAAQ,MAAM,CAAC,kBAAkB,CAAC;IACxD,OAAO,OAAO,CAAC,GAAG;QAChB,OAAO,GAAG,YAAY,UAAU,CAAC;KAClC;IACD,OAAO,MAAM,CAAC,QAAa,IAAI;QAC7B,IAAI,KAAK,IAAI,IAAI;YAAE,OAAO,UAAU,CAAC,WAAW,EAAE,CAAC;QACnD,IAAI,GAAe,CAAC;QACpB,IAAI,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;YAC7B,GAAG,GAAG,KAAK,CAAC;SACb;QAED,IAAI,aAAa,CAAC,KAAK,CAAC,EAAE;YACxB,GAAG,GAAG,UAAU,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;SAClC;QACD,IAAI,GAAG,EAAE;YACP,IAAI,GAAG,CAAC,QAAQ,IAAI,IAAI,EAAE;gBACxB,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,YAAY,CAAC,CAAC;aAC7C;YACD,IAAI,GAAG,CAAC,SAAS,IAAI,IAAI,EAAE;gBACzB,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;aAC9C;YACD,OAAO,GAAG,CAAC;SACZ;QAED,MAAM,IAAI,KAAK,CACb,uEAAuE,KAAK,EAAE,CAC/E,CAAC;KACH;IAED,OAAO,WAAW,CAAC,GAAI;QACrB,MAAM,KAAK,GAAG,IAAI,UAAU,EAAE,CAAC;QAC/B,MAAM,SAAS,GAAG,KAAK,CAAC,MAAM,CAAC,EAAE,GAAG,EAAE,SAAS,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC,CAAC;QAC3E,OAAO,KAAK;aACT,GAAG,CAAC,IAAI,EAAE,SAAS,EAAE,CAAC;aACtB,MAAM,CAAC,QAAQ,EAAE,MAAM,IAAI,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC;aAChE,GAAG,CAAC,cAAc,EAAE,SAAS,CAAC,GAAG,CAAC;aAClC,GAAG,CAAC,oBAAoB,EAAE,SAAS,CAAC,GAAG,CAAC;aACxC,GAAG,CAAC,UAAU,EAAE,SAAS,CAAC,GAAG,CAAC;aAC9B,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC,MAAM,CAAC;aAClC,KAAK,CAAC,GAAG,CAAC,CAAC;KACf;IAED,OAAO,QAAQ,CAAC,MAAM;QACpB,IAAI,KAAK,GAAG,IAAI,UAAU,EAAE,CAAC;QAC7B,MAAM,EAAE,MAAM,GAAG,EAAE,EAAE,MAAM,GAAG,EAAE,EAAE,YAAY,EAAE,GAAG,MAAM,CAAC;QAC1D,IAAI,EAAE,kBAAkB,EAAE,GAAG,MAAM,CAAC;QAEpC,IAAI,kBAAkB,KAAK,SAAS;YAAE,kBAAkB,GAAG,YAAY,CAAC;QAExE,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC;YAClB,YAAY;YACZ,kBAAkB;SACnB,CAAC,CAAC;QAEH,KAAK,GAAG,KAAK,CAAC,aAAa,CAAC,KAAK;YAC/B,MAAM,CAAC,OAAO,CAAC,KAAK;gBAClB,KAAK,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,IAC3B,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAC7C,CAAC;aACH,CAAC,CAAC;YACH,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;SAC9C,CAAC,CAAC;QAEH,OAAO,KAAK,CAAC;KACd;IAED,IAAI;QACF,OAAO;YACL,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,YAAY,EAAE,IAAI,CAAC,YAAY;YAC/B,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;YACzC,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,UAAU,EAAE,IAAI,CAAC,UAAU;SAC5B,CAAC;KACH;IAED,IAAI,EAAE;QACJ,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;KACvB;IAED,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KAC1B;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KAC3B;IAED,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;KAC3B;IAED,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;KAClC;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;KACjC;IAED,IAAI,kBAAkB;QACpB,OAAO,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;KACvC;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;KAC7B;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;KAC9B;IAED,IAAI,iBAAiB;QACnB,OAAO,CAAC,SAAS,CAAC,eAAe,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC,QAAQ,CAC/D,IAAI,CAAC,SAAS,CACf;cACG,IAAI,CAAC,QAAQ;cACb,IAAI,CAAC;KACV;IAED,IAAI,cAAc;QAChB,OAAO,IAAI,CAAC,SAAS,KAAK,SAAS,CAAC,YAAY,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;KACzE;IAED,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;KACjC;IAED,IAAI,mBAAmB;QACrB,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KAC7C;IAED,QAAQ,CAAC,GAAY;QACnB,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KAC7B;IAED,cAAc,CAAC,GAAY;QACzB,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QACjC,OAAO,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC;KAChE;IAED,YAAY,CAAC,GAAY;QACvB,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC;KACrC;IAED,qBAAqB,CAAC,GAAY;QAChC,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;QACnC,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACrC,IAAI,KAAK,KAAK,CAAC;YAAE,OAAO,IAAI,CAAC;QAC7B,OAAO,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;KACjC;IAED,iBAAiB,CAAC,GAAY;QAC5B,MAAM,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;QACnC,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACrC,IAAI,KAAK,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,GAAG,CAAC;YAAE,OAAO,IAAI,CAAC;QAC9C,OAAO,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;KACjC;IAED,cAAc,CAAC,GAAY;QACzB,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAC/B,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG,KAAK,IAAI,CAAC,kBAAkB,EAAE;YACrD,KAAK,EAAE,CAAC;YACR,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;SACxC;QACD,OAAO,KAAK,CAAC;KACd;IAED,QAAQ,CAAC,GAAY;QACnB,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAC/B,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,OAAO,KAAK,IAAI,KAAK,CAAC,GAAG,KAAK,IAAI,CAAC,YAAY,EAAE;YAC/C,KAAK,EAAE,CAAC;YACR,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;SACxC;QACD,OAAO,KAAK,CAAC;KACd;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;KACzC;IAED,IAAI,iBAAiB;QACnB,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KACrC;;IAGD,IAAI,UAAU;QACZ,OAAO,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;KAC/B;IAED,eAAe,CAAC,QAAiB;QAC/B,OAAO,QAAQ,KAAK,IAAI,CAAC,kBAAkB,CAAC;KAC7C;CACF;;ACzND,MAAM,gBAAgB,GAAkB;IACtC,WAAW,EAAE,IAAI,EAAE;IACnB,OAAO,EAAEA,KAAG,EAAE;IACd,iBAAiB,EAAE,CAAC,CAAC;IACrB,aAAa,EAAE,KAAK;CACrB,CAAC;AAEF,MAAa,QAAS,SAAQ,MAAM,CAAC,gBAAgB,CAAC;IACpD,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;KAChC;IAED,IAAI,iBAAiB;QACnB,OAAO,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;KACtC;IAED,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;KAClC;IAED,OAAO,WAAW;QAChB,OAAO,IAAI,QAAQ,CAAC;YAClB,WAAW,EAAE,IAAI,CAAC,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC;YAC7C,iBAAiB,EAAE,CAAC;SACrB,CAAC,CAAC;KACJ;IAED,IAAI,iBAAiB;QACnB,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;KACrD;IAED,IAAI,OAAO;QACT,OAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;KAC5B;IAED,aAAa,CAAC,OAAe;QAC3B,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,OAAO,CAAC,CAAC;KACrD;IAED,aAAa,CAAC,UAAgC;QAC5C,OAAO,UAAU,YAAY,UAAU;cACnC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAU,CAAC;cACpC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,UAAU,CAAC,CAAC;KAC1D;IAED,cAAc,CAAI,GAAW,EAAE,CAAc;QAC3C,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,EAAE,CAAC;KACzC;IAED,2BAA2B,CAAC,QAAiB;QAC3C,MAAM,KAAK,GAAe,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,IAC/C,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CACvB,CAAC;QACF,OAAO,KAAK,GAAG,KAAK,CAAC,EAAE,GAAG,IAAI,CAAC;KAChC;CACF;;SCrEe,UAAU,CAAC,UAAe,EAAE;IAC1C,MAAM,EAAE,OAAO,GAAG,EAAE,EAAE,GAAG,OAAO,CAAC;IACjC,OAAO,CAAC,GAAG,OAAO,CAAC,CAAC;AACtB,CAAC;;ACID,MAAMD,KAAG,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC;AA2BrC,SAAS,cAAc,CAAC,UAAsB,EAAE,MAAW;IACzD,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;QACzB,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,cAAc,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;QACnD,OAAO;KACR;IAED,IAAI,MAAM,IAAI,IAAI,EAAE;QAClB,OAAO;KACR;IAED,KAAK,MAAM,GAAG,IAAI,MAAM,EAAE;QACxB,MAAM,EAAE,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;QACvB,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;QAC9D,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KACrC;AACH,CAAC;AAED;AACA,SAAS,OAAO,CAAC,UAAU;IACzB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC;QAC5B,MAAM,IAAI,SAAS,CAAC,oCAAoC,CAAC,CAAC;IAC5D,KAAK,MAAM,EAAE,IAAI,UAAU,EAAE;QAC3B,IAAI,OAAO,EAAE,KAAK,UAAU;YAC1B,MAAM,IAAI,SAAS,CAAC,2CAA2C,CAAC,CAAC;KACpE;IAED,OAAO,UAAS,OAAO,EAAE,IAAI;;QAE3B,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;QACf,OAAO,QAAQ,CAAC,CAAC,CAAC,CAAC;QACnB,SAAS,QAAQ,CAAC,CAAC;YACjB,IAAI,CAAC,IAAI,KAAK;gBAAE,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;YAChE,KAAK,GAAG,CAAC,CAAC;YACV,IAAI,EAAE,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YACvB,IAAI,CAAC,KAAK,UAAU,CAAC,MAAM;gBAAE,EAAE,GAAG,IAAI,CAAC;YACvC,IAAI,CAAC,EAAE;gBAAE,OAAO,IAAI,CAAC;YACrB,IAAI;gBACF,OAAO,EAAE,CAAC,OAAO,EAAE,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;aAChD;YAAC,OAAO,GAAG,EAAE;gBACZ,MAAM,GAAG,CAAC;aACX;SACF;KACF,CAAC;AACJ,CAAC;AAED,MAAa,UAAU;IAUrB,YAAY,UAA6B,EAAE;QACzC,MAAM,EAAE,OAAO,GAAG,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,OAAO,CAAC;QACrD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,UAAU,GAAG,IAAI,GAAG,EAAE,CAAC;QAC5B,MAAM,UAAU,GAAG,UAAU,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;QAC3C,cAAc,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;KAClC;IAXD,IAAI,KAAK;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC;KACxC;IAWD,GAAG,CAAC,GAAW,EAAE,GAAI;QACnB,IAAI;YACF,MAAM,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC;YAC5B,MAAM,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;YAClC,OAAO,CAAC,GAAG,CAAC,MAAM,KAAK,CAAC,EAAE,2BAA2B,GAAG,gBAAgB,CAAC,CAAC;YAC1E,MAAM,UAAU,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;;YAE5C,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;SACxB;QAAC,OAAO,CAAC,EAAE;YACV,IAAI,CAAC,GAAG,CAAC,cAAc,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;SACxC;KACF;IAED,QAAQ,CAAC,OAAe,EAAE,GAAI;QAC5B,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,GAAG,GAAG,EAAE,OAAO,EAAE,CAAC,CAAC;KAClD;IAED,MAAM,CAAC,KAAe,EAAE,QAA8B;QACpDA,KAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,KAAK,CAAC,iBAAiB,CAAC,CAAC;QAC9C,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;KAChC;CACF;;;;"}